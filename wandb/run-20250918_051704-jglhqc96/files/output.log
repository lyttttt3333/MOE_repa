Steps:   0%|                                                                      | 0/400000 [00:00<?, ?it/s]
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([2.3673, 2.2928, 2.6329, 2.2825, 2.3728, 2.4186, 2.3230, 2.2983, 2.3213,
        2.5018, 2.3583, 2.4256, 2.2935, 2.3382, 2.4651, 2.4495, 2.1033, 2.2313,
        2.2964, 2.4079, 2.4989, 2.2564, 2.3206, 2.2922, 2.4440, 2.3933, 2.3627,
        2.3317, 2.3458, 2.4240, 2.1791, 2.4268, 2.2705, 2.3041, 2.3650, 2.1539,
        2.3719, 2.3066, 2.2545, 2.2993, 2.3230, 2.3613, 2.2943, 2.2859, 2.2846,
        2.3619, 2.2960, 2.3249, 2.0968, 2.1516, 2.2869, 2.3376, 2.2041, 2.2271,
        2.2876, 2.3333, 2.3952, 2.3081, 2.3207, 2.2751, 2.2680, 2.3096, 2.2575,
        2.3952, 2.2149, 2.2082, 2.2803, 2.2678, 2.2975, 2.2815, 2.3182, 2.1452,
        2.2187, 2.2723, 2.1499, 2.2333, 2.2495, 2.3453, 2.3374, 2.2759, 2.1747,
        2.2142, 2.2357, 2.3157, 2.2643, 2.1697, 2.2404, 2.2622, 2.2844, 2.3370,
        2.1773, 2.2548, 2.1859, 2.3356, 2.2041, 2.3105, 2.0698, 2.1542, 1.9655,
        2.1367, 2.0627, 2.1076, 2.0918, 2.0203, 1.9733, 2.0883, 1.9919, 2.0561,
        1.9769, 2.1279, 1.9864, 1.9988, 2.0977, 1.9871, 1.9898, 2.0193, 1.9884,
        2.0559, 2.1221, 2.0782, 2.1144, 2.1158, 2.0308, 2.0211, 1.9539, 2.0396,
        1.8578, 2.1091, 2.4075, 2.4763, 2.5130, 2.4967, 2.3478, 2.4682, 2.5879,
        2.4138, 2.5604, 2.5291, 2.5101, 2.5664, 2.2416, 2.6125, 2.5043, 2.4757,
        2.0954, 2.4536, 2.3294, 2.3241, 2.4923, 2.4376, 2.6366, 2.3268, 2.4312,
        2.3489, 2.3606, 2.5606, 2.3684, 2.4469, 2.5344, 2.1606, 2.0080, 2.1418,
        2.0299, 1.9788, 2.0970, 2.0479, 2.1681, 1.8906, 2.0291, 2.1378, 1.9233,
        1.9583, 1.9669, 2.2115, 2.1268, 2.0173, 1.7678, 1.9613, 1.8219, 2.0368,
        2.0280, 1.9629, 1.9178, 1.9370, 2.1357, 1.9728, 1.9792, 2.1568, 2.0493,
        2.0380, 2.0228, 1.6954, 2.0325, 2.0713, 2.1342, 2.0049, 2.1204, 2.1127,
        2.1920, 2.1314, 2.0350, 2.1849, 1.9196, 2.1493, 2.1166, 2.1830, 2.0359,
        2.0563, 2.0235, 2.1961, 2.2328, 2.1003, 1.9382, 1.9995, 2.1177, 2.1677,
        2.1334, 2.1536, 1.9694, 2.1909, 1.9987, 2.1363, 2.0294, 1.9604, 1.8014,
        1.7874, 1.7135, 1.7282, 1.7961, 1.8684, 1.8795, 1.7855, 1.7097, 1.9149,
        1.7173, 1.7759, 1.7174, 1.7078, 1.8253, 1.7683, 1.5533, 1.8191, 1.8227,
        1.8618, 1.7256, 1.7612, 1.8513, 1.7108, 1.9353, 1.9068, 1.7315, 1.7956,
        1.7339, 1.8150, 1.7269, 1.9309, 2.3191, 2.4009, 2.5294, 2.3603, 2.2170,
        2.4665, 2.4085, 2.3702, 2.3908, 2.3846, 2.4005, 2.4373, 2.2600, 2.4712,
        2.5065, 2.4163, 2.0476, 2.2916, 2.2610, 2.3798, 2.2589, 2.3474, 2.3441,
        2.2686, 2.4266, 2.4526, 2.2934, 2.4037, 2.3467, 2.4262, 2.3406, 2.2960,
        2.1641, 2.1114, 2.0495, 1.9964, 2.0235, 2.1591, 2.1118, 2.0728, 2.0721,
        2.0882, 1.9671, 2.0878, 2.0348, 1.9926, 1.9497, 2.0161, 1.8076, 2.0307,
        2.0116, 2.0705, 2.0510, 1.9654, 1.9681, 2.0375, 2.2031, 2.0565, 2.0647,
        2.1544, 2.1071, 1.9828, 2.1255, 2.0006, 2.0846, 2.0873, 1.9469, 2.0823,
        2.0666, 2.0851, 2.1839, 2.1595, 2.0273, 1.9841, 2.0134, 2.1195, 1.9924,
        2.0012, 2.1437, 2.1449, 1.9325, 1.9360, 2.0867, 2.0218, 2.0725, 2.0607,
        2.1043, 2.0693, 2.1851, 1.9685, 2.1873, 2.0331, 2.0766, 2.0884, 2.1131,
        1.9865, 1.8244, 1.8359, 1.7532, 1.9099, 1.8493, 1.8446, 1.9221, 1.8572,
        1.8220, 1.8300, 1.8214, 1.8161, 1.8541, 1.7110, 1.7755, 1.8512, 1.5687,
        1.8397, 1.8316, 1.8026, 1.8736, 1.6809, 1.8032, 1.7870, 1.9661, 1.8158,
        1.7776, 1.8277, 1.8386, 1.8425, 1.9832, 1.7599, 2.1761, 2.0430, 1.8895,
        1.8869, 2.0070, 1.9383, 1.8940, 1.8842, 2.1030, 1.9283, 1.8936, 2.0588,
        1.9150, 1.9518, 1.9168, 1.9502, 1.8080, 1.9302, 2.0379, 1.9240, 1.8712,
        1.8463, 1.9740, 2.0851, 1.9805, 1.8948, 1.8470, 1.8314, 1.8775, 1.9707,
        1.9792, 2.0227, 1.9552, 1.8582, 1.8558, 1.7588, 1.7441, 1.8663, 1.7883,
        1.7659, 1.8125, 1.8417, 1.8415, 1.7802, 1.8301, 1.7275, 1.7346, 1.7614,
        1.6167, 1.8028, 1.8590, 1.6916, 1.7229, 1.7292, 1.8048, 1.7738, 1.7941,
        1.8162, 1.6798, 1.7599, 1.7737, 1.8479, 1.8174, 1.8713, 2.0139, 2.0340,
        1.9051, 1.9275, 1.9072, 2.0374, 2.0055, 1.8999, 2.0063, 1.9817, 1.9393,
        1.9203, 1.9195, 1.8264, 1.8940, 1.9614, 1.7281, 1.9861, 1.9114, 1.8030,
        1.8028, 1.9074, 1.9199, 1.9337, 1.9125, 1.9646, 1.8192, 1.9026, 1.9177,
        1.9805, 2.0017, 2.0656, 1.8484, 1.8266, 1.7464, 1.7701, 1.8245, 1.8220,
        1.8710, 1.7778, 1.8247, 1.7810, 1.7374, 1.7610, 1.7655, 1.6270, 1.7308,
        1.7997, 1.4271, 1.7446, 1.7554, 1.6491, 1.7796, 1.7713, 1.7824, 1.7559,
        1.8447, 1.7919, 1.6504, 1.7142, 1.7054, 1.8234, 1.6981, 1.8332],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([5.6042, 5.2570, 6.9324, 5.2097, 5.6303, 5.8497, 5.3963, 5.2824, 5.3884,
        6.2590, 5.5616, 5.8836, 5.2600, 5.4671, 6.0766, 6.0002, 4.4238, 4.9786,
        5.2735, 5.7981, 6.2443, 5.0915, 5.3853, 5.2543, 5.9729, 5.7277, 5.5823,
        5.4368, 5.5027, 5.8758, 4.7483, 5.8896, 5.1553, 5.3090, 5.5933, 4.6392,
        5.6260, 5.3202, 5.0830, 5.2866, 5.3964, 5.5756, 5.2637, 5.2254, 5.2195,
        5.5786, 5.2714, 5.4052, 4.3964, 4.6294, 5.2299, 5.4645, 4.8579, 4.9600,
        5.2333, 5.4445, 5.7372, 5.3274, 5.3858, 5.1761, 5.1439, 5.3341, 5.0965,
        5.7368, 4.9057, 4.8762, 5.1996, 5.1429, 5.2784, 5.2053, 5.3739, 4.6019,
        4.9225, 5.1635, 4.6221, 4.9878, 5.0604, 5.5003, 5.4636, 5.1797, 4.7292,
        4.9028, 4.9982, 5.3626, 5.1269, 4.7076, 5.0195, 5.1174, 5.2187, 5.4616,
        4.7406, 5.0840, 4.7781, 5.4548, 4.8580, 5.3383, 4.2840, 4.6408, 3.8633,
        4.5655, 4.2547, 4.4422, 4.3755, 4.0817, 3.8941, 4.3609, 3.9676, 4.2276,
        3.9082, 4.5281, 3.9459, 3.9951, 4.4002, 3.9485, 3.9594, 4.0776, 3.9535,
        4.2267, 4.5033, 4.3189, 4.4707, 4.4768, 4.1243, 4.0850, 3.8179, 4.1600,
        3.4515, 4.4485, 5.7963, 6.1320, 6.3153, 6.2333, 5.5120, 6.0921, 6.6970,
        5.8264, 6.5555, 6.3962, 6.3004, 6.5865, 5.0246, 6.8253, 6.2715, 6.1293,
        4.3907, 6.0204, 5.4261, 5.4016, 6.2115, 5.9417, 6.9514, 5.4139, 5.9109,
        5.5175, 5.5726, 6.5567, 5.6092, 5.9871, 6.4231, 4.6684, 4.0322, 4.5873,
        4.1206, 3.9155, 4.3973, 4.1939, 4.7008, 3.5744, 4.1171, 4.5701, 3.6990,
        3.8349, 3.8689, 4.8908, 4.5235, 4.0696, 3.1252, 3.8465, 3.3193, 4.1484,
        4.1127, 3.8530, 3.6779, 3.7522, 4.5613, 3.8918, 3.9172, 4.6518, 4.1994,
        4.1534, 4.0915, 2.8742, 4.1310, 4.2905, 4.5549, 4.0197, 4.4959, 4.4634,
        4.8047, 4.5427, 4.1410, 4.7736, 3.6850, 4.6193, 4.4800, 4.7653, 4.1449,
        4.2284, 4.0947, 4.8228, 4.9853, 4.4113, 3.7566, 3.9979, 4.4846, 4.6991,
        4.5516, 4.6382, 3.8784, 4.8001, 3.9948, 4.5636, 4.1186, 3.8432, 3.2451,
        3.1948, 2.9362, 2.9867, 3.2260, 3.4910, 3.5324, 3.1878, 2.9230, 3.6668,
        2.9493, 3.1539, 2.9494, 2.9167, 3.3316, 3.1267, 2.4127, 3.3092, 3.3222,
        3.4662, 2.9777, 3.1020, 3.4274, 2.9269, 3.7454, 3.6357, 2.9982, 3.2242,
        3.0065, 3.2941, 2.9823, 3.7285, 5.3783, 5.7643, 6.3979, 5.5710, 4.9153,
        6.0834, 5.8007, 5.6179, 5.7161, 5.6865, 5.7622, 5.9403, 5.1075, 6.1067,
        6.2827, 5.8383, 4.1926, 5.2513, 5.1121, 5.6635, 5.1026, 5.5105, 5.4949,
        5.1466, 5.8885, 6.0151, 5.2598, 5.7780, 5.5070, 5.8864, 5.4784, 5.2717,
        4.6833, 4.4579, 4.2006, 3.9858, 4.0945, 4.6617, 4.4597, 4.2965, 4.2935,
        4.3607, 3.8695, 4.3589, 4.1405, 3.9705, 3.8014, 4.0646, 3.2675, 4.1236,
        4.0463, 4.2871, 4.2065, 3.8628, 3.8733, 4.1514, 4.8538, 4.2293, 4.2629,
        4.6413, 4.4399, 3.9316, 4.5176, 4.0022, 4.3457, 4.3569, 3.7905, 4.3361,
        4.2710, 4.3474, 4.7695, 4.6634, 4.1099, 3.9365, 4.0536, 4.4925, 3.9695,
        4.0048, 4.5954, 4.6006, 3.7345, 3.7480, 4.3544, 4.0878, 4.2953, 4.2464,
        4.4283, 4.2822, 4.7745, 3.8750, 4.7843, 4.1337, 4.3122, 4.3613, 4.4653,
        3.9463, 3.3285, 3.3705, 3.0738, 3.6479, 3.4198, 3.4026, 3.6946, 3.4490,
        3.3195, 3.3487, 3.3175, 3.2982, 3.4376, 2.9277, 3.1523, 3.4270, 2.4607,
        3.3845, 3.3547, 3.2495, 3.5105, 2.8254, 3.2516, 3.1933, 3.8655, 3.2971,
        3.1597, 3.3403, 3.3803, 3.3946, 3.9331, 3.0974, 4.7353, 4.1737, 3.5702,
        3.5602, 4.0280, 3.7570, 3.5872, 3.5502, 4.4227, 3.7184, 3.5859, 4.2386,
        3.6673, 3.8097, 3.6740, 3.8034, 3.2688, 3.7256, 4.1532, 3.7017, 3.5013,
        3.4088, 3.8967, 4.3475, 3.9224, 3.5903, 3.4114, 3.3539, 3.5251, 3.8838,
        3.9172, 4.0913, 3.8228, 3.4531, 3.4441, 3.0935, 3.0420, 3.4831, 3.1980,
        3.1183, 3.2850, 3.3917, 3.3911, 3.1691, 3.3492, 2.9844, 3.0090, 3.1026,
        2.6138, 3.2502, 3.4559, 2.8615, 2.9683, 2.9900, 3.2574, 3.1465, 3.2187,
        3.2986, 2.8217, 3.0972, 3.1460, 3.4148, 3.3029, 3.5017, 4.0557, 4.1371,
        3.6294, 3.7153, 3.6375, 4.1510, 4.0220, 3.6098, 4.0253, 3.9272, 3.7609,
        3.6875, 3.6846, 3.3358, 3.5873, 3.8473, 2.9862, 3.9447, 3.6533, 3.2508,
        3.2503, 3.6382, 3.6861, 3.7394, 3.6576, 3.8596, 3.3095, 3.6200, 3.6776,
        3.9224, 4.0066, 4.2668, 3.4166, 3.3366, 3.0499, 3.1332, 3.3287, 3.3199,
        3.5008, 3.1605, 3.3296, 3.1720, 3.0185, 3.1010, 3.1170, 2.6473, 2.9955,
        3.2388, 2.0366, 3.0438, 3.0813, 2.7195, 3.1671, 3.1374, 3.1769, 3.0832,
        3.4028, 3.2109, 2.7240, 2.9386, 2.9084, 3.3247, 2.8835, 3.3605],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 2202.932861328125
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([2.4377, 2.3723, 2.5359, 2.3964, 2.3512, 2.4346, 2.3513, 2.3414, 2.3662,
        2.4138, 2.4522, 2.3913, 2.4261, 2.2853, 2.4080, 2.4312, 2.1720, 2.3562,
        2.3687, 2.3466, 2.3512, 2.4284, 2.3983, 2.3697, 2.3940, 2.4830, 2.3941,
        2.4166, 2.3555, 2.4522, 2.3664, 2.4496, 1.7810, 1.7899, 1.8060, 1.7376,
        1.7788, 1.7194, 1.6697, 1.6507, 1.6739, 1.7606, 1.7302, 1.8149, 1.8320,
        1.7368, 1.7424, 1.7650, 1.6741, 1.7138, 1.7532, 1.8516, 1.7521, 1.8301,
        1.7767, 1.6897, 1.7213, 1.7948, 1.9460, 1.7129, 1.6600, 1.7850, 1.7068,
        1.6921, 1.8259, 1.9402, 1.7752, 1.8276, 1.8776, 1.7368, 1.7048, 1.7768,
        1.8140, 2.0040, 1.8671, 1.8399, 1.9575, 1.8384, 1.9586, 1.9177, 1.9538,
        1.7787, 1.8160, 2.0130, 1.6967, 2.0408, 1.7348, 1.9479, 1.7265, 1.8743,
        2.0999, 2.0389, 1.6991, 1.7335, 1.7275, 1.9258, 1.9410, 1.9929, 2.0500,
        1.9293, 1.9510, 1.8912, 1.9029, 1.8708, 1.9330, 2.1119, 2.0522, 2.0038,
        1.9854, 2.0016, 2.0914, 1.9412, 2.0510, 1.8898, 1.9686, 2.0696, 1.8651,
        2.0620, 1.9326, 1.9304, 1.9453, 2.1482, 1.8774, 2.1112, 1.8995, 2.0846,
        2.0598, 2.0674, 3.0846, 3.0370, 3.1528, 2.9989, 3.0605, 3.1312, 3.0847,
        3.0698, 2.9527, 3.0902, 3.1490, 3.1350, 3.0830, 3.2508, 3.1152, 3.1294,
        2.8253, 3.0346, 3.0478, 3.1874, 3.0563, 2.9858, 2.9408, 3.0827, 3.1644,
        3.1263, 3.0975, 3.0427, 3.0533, 3.1605, 2.9961, 2.9796, 2.4397, 2.3284,
        2.3894, 2.2230, 2.3586, 2.3385, 2.3991, 2.2926, 2.2376, 2.3397, 2.2740,
        2.3266, 2.3076, 2.3801, 2.3471, 2.3466, 2.2222, 2.2265, 2.3697, 2.3422,
        2.3697, 2.2947, 2.3717, 2.3550, 2.3331, 2.3826, 2.2958, 2.2821, 2.2393,
        2.3397, 2.2608, 2.2425, 2.1877, 2.1171, 2.0949, 2.1389, 2.2244, 2.1479,
        2.1908, 2.0552, 2.1491, 2.1570, 2.0997, 2.1676, 2.1512, 2.1706, 2.1951,
        2.1140, 2.1032, 2.0850, 2.0951, 2.1572, 2.0601, 2.0913, 2.1750, 2.0953,
        2.2058, 2.1828, 2.2367, 2.2672, 2.0808, 2.0800, 2.1477, 2.0012, 2.2796,
        2.3064, 2.2432, 2.1417, 2.2477, 2.3321, 2.3197, 2.2617, 2.3447, 2.3837,
        2.3056, 2.2107, 2.3195, 2.2973, 2.3076, 2.3271, 2.2455, 2.1389, 2.3121,
        2.3450, 2.2064, 2.3094, 2.2210, 2.2495, 2.3656, 2.3500, 2.1693, 2.4058,
        2.2101, 2.3148, 2.2288, 2.4549, 2.9872, 2.9581, 2.9759, 2.8566, 2.8717,
        2.9604, 2.9631, 2.8441, 2.9160, 2.8876, 2.9227, 2.9719, 2.9776, 2.9696,
        2.8675, 2.8863, 2.8054, 2.8030, 2.8817, 2.8484, 2.8440, 2.8405, 2.9446,
        2.8734, 2.7963, 2.8934, 2.9902, 2.8517, 2.9547, 2.9004, 2.9555, 3.0549,
        2.2981, 2.2456, 2.2413, 2.2652, 2.1805, 2.2018, 2.2370, 2.1962, 2.2330,
        2.1755, 2.0867, 2.2046, 2.1952, 2.1253, 2.1835, 2.1828, 2.1516, 2.2540,
        2.2255, 2.1274, 2.2355, 2.1790, 2.1851, 2.2341, 2.2819, 2.2524, 2.2696,
        2.2641, 2.1120, 2.2048, 2.2024, 2.1375, 2.1936, 2.1934, 2.1037, 2.2261,
        2.1454, 2.1787, 2.2323, 2.2552, 2.2283, 2.2001, 2.0751, 2.1912, 2.2013,
        2.1494, 2.1658, 2.1503, 2.2109, 2.0524, 2.1202, 2.1876, 2.0859, 2.2055,
        2.1607, 2.2036, 2.3229, 2.0944, 2.2286, 2.2038, 2.1145, 2.1136, 2.2122,
        1.9821, 2.2444, 2.2936, 2.2780, 2.1711, 2.2947, 2.2709, 2.3269, 2.2120,
        2.2432, 2.3238, 2.2534, 2.2416, 2.3163, 2.2002, 2.3413, 2.2290, 2.3527,
        2.2045, 2.3151, 2.2979, 2.1742, 2.2952, 2.2773, 2.2077, 2.4747, 2.2349,
        2.1914, 2.2998, 2.3205, 2.3205, 2.2023, 2.3286, 2.3308, 2.2562, 2.2472,
        2.3133, 2.2314, 2.2346, 2.2758, 2.2412, 2.2665, 2.2189, 2.2883, 2.2714,
        2.2754, 2.1772, 2.2402, 2.2589, 2.2092, 2.2545, 2.2370, 2.2475, 2.2364,
        2.2317, 2.2455, 2.2386, 2.1844, 2.3251, 2.4159, 2.2916, 2.2263, 2.1895,
        2.2229, 2.2491, 1.9376, 1.8836, 1.8473, 1.8213, 1.8759, 1.8355, 1.8191,
        1.8400, 1.8293, 1.8835, 1.8770, 1.9344, 1.7911, 1.8336, 1.9088, 1.9405,
        1.8829, 1.9046, 1.8676, 1.8631, 1.8539, 1.8024, 1.9162, 1.8683, 1.9891,
        1.8754, 2.0210, 1.9115, 1.8769, 1.8241, 1.8657, 1.8421, 2.0219, 2.0508,
        1.7835, 1.9579, 1.9359, 1.8643, 1.9113, 1.8418, 1.9337, 2.0178, 1.8866,
        1.9224, 1.9829, 1.9083, 1.9464, 1.9328, 2.0529, 1.9483, 1.8716, 1.8550,
        1.9541, 1.9762, 1.8554, 1.8703, 2.0579, 1.9872, 1.9678, 1.9909, 1.9406,
        1.8336, 1.9689, 1.9423, 2.0135, 2.0004, 1.8379, 1.9260, 1.8519, 1.9062,
        1.9942, 1.8072, 1.9034, 2.0237, 1.8692, 1.8931, 1.9867, 1.7772, 1.9355,
        1.9091, 2.0784, 1.8876, 1.9294, 1.9588, 1.8933, 1.8062, 1.9071, 1.9839,
        1.9251, 2.0185, 1.9044, 1.9311, 1.9517, 1.8247, 1.8571, 1.9046],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([ 5.9426,  5.6280,  6.4309,  5.7429,  5.5282,  5.9273,  5.5286,  5.4820,
         5.5989,  5.8265,  6.0135,  5.7184,  5.8860,  5.2227,  5.7982,  5.9110,
         4.7178,  5.5518,  5.6109,  5.5065,  5.5281,  5.8971,  5.7516,  5.6156,
         5.7310,  6.1653,  5.7317,  5.8401,  5.5483,  6.0134,  5.6001,  6.0005,
         3.1721,  3.2038,  3.2615,  3.0191,  3.1640,  2.9562,  2.7878,  2.7247,
         2.8019,  3.0995,  2.9937,  3.2939,  3.3561,  3.0164,  3.0360,  3.1152,
         2.8027,  2.9371,  3.0738,  3.4283,  3.0700,  3.3494,  3.1565,  2.8551,
         2.9629,  3.2215,  3.7869,  2.9342,  2.7555,  3.1863,  2.9130,  2.8630,
         3.3339,  3.7645,  3.1513,  3.3400,  3.5252,  3.0166,  2.9062,  3.1570,
         3.2906,  4.0160,  3.4859,  3.3853,  3.8316,  3.3797,  3.8360,  3.6775,
         3.8175,  3.1637,  3.2978,  4.0520,  2.8789,  4.1649,  3.0096,  3.7943,
         2.9806,  3.5129,  4.4095,  4.1571,  2.8870,  3.0049,  2.9843,  3.7089,
         3.7674,  3.9716,  4.2026,  3.7223,  3.8065,  3.5765,  3.6210,  3.4999,
         3.7364,  4.4601,  4.2114,  4.0153,  3.9417,  4.0063,  4.3739,  3.7684,
         4.2068,  3.5715,  3.8752,  4.2832,  3.4785,  4.2519,  3.7348,  3.7263,
         3.7843,  4.6148,  3.5245,  4.4570,  3.6080,  4.3454,  4.2428,  4.2741,
         9.5149,  9.2232,  9.9403,  8.9934,  9.3664,  9.8047,  9.5153,  9.4239,
         8.7184,  9.5496,  9.9165,  9.8282,  9.5047, 10.5676,  9.7046,  9.7931,
         7.9823,  9.2085,  9.2889, 10.1594,  9.3407,  8.9153,  8.6485,  9.5029,
        10.0135,  9.7735,  9.5944,  9.2579,  9.3224,  9.9890,  8.9764,  8.8779,
         5.9523,  5.4215,  5.7092,  4.9415,  5.5630,  5.4688,  5.7555,  5.2562,
         5.0068,  5.4742,  5.1711,  5.4131,  5.3248,  5.6649,  5.5089,  5.5065,
         4.9380,  4.9574,  5.6156,  5.4859,  5.6156,  5.2658,  5.6252,  5.5462,
         5.4432,  5.6766,  5.2707,  5.2082,  5.0146,  5.4742,  5.1110,  5.0290,
         4.7862,  4.4823,  4.3885,  4.5750,  4.9480,  4.6134,  4.7995,  4.2237,
         4.6188,  4.6526,  4.4088,  4.6984,  4.6277,  4.7115,  4.8185,  4.4688,
         4.4236,  4.3471,  4.3893,  4.6534,  4.2439,  4.3737,  4.7305,  4.3904,
         4.8658,  4.7645,  5.0028,  5.1401,  4.3299,  4.3266,  4.6126,  4.0047,
         5.1965,  5.3196,  5.0319,  4.5867,  5.0520,  5.4387,  5.3812,  5.1152,
         5.4978,  5.6818,  5.3160,  4.8873,  5.3800,  5.2774,  5.3252,  5.4154,
         5.0423,  4.5748,  5.3456,  5.4991,  4.8680,  5.3334,  4.9330,  5.0604,
         5.5960,  5.5224,  4.7060,  5.7881,  4.8846,  5.3584,  4.9677,  6.0264,
         8.9231,  8.7504,  8.8562,  8.1602,  8.2464,  8.7641,  8.7801,  8.0890,
         8.5032,  8.3381,  8.5423,  8.8321,  8.8662,  8.8183,  8.2226,  8.3309,
         7.8705,  7.8569,  8.3044,  8.1135,  8.0885,  8.0683,  8.6708,  8.2562,
         7.8193,  8.3716,  8.9410,  8.1319,  8.7301,  8.4125,  8.7350,  9.3327,
         5.2812,  5.0429,  5.0236,  5.1311,  4.7545,  4.8480,  5.0041,  4.8235,
         4.9861,  4.7327,  4.3542,  4.8602,  4.8187,  4.5171,  4.7676,  4.7648,
         4.6293,  5.0803,  4.9529,  4.5257,  4.9975,  4.7483,  4.7745,  4.9914,
         5.2073,  5.0734,  5.1512,  5.1260,  4.4605,  4.8612,  4.8507,  4.5688,
         4.8120,  4.8110,  4.4256,  4.9554,  4.6029,  4.7465,  4.9831,  5.0860,
         4.9651,  4.8403,  4.3062,  4.8013,  4.8457,  4.6198,  4.6908,  4.6237,
         4.8879,  4.2123,  4.4951,  4.7854,  4.3512,  4.8644,  4.6685,  4.8558,
         5.3960,  4.3866,  4.9665,  4.8568,  4.4711,  4.4672,  4.8939,  3.9285,
         5.0374,  5.2605,  5.1893,  4.7135,  5.2657,  5.1571,  5.4146,  4.8929,
         5.0321,  5.4002,  5.0777,  5.0250,  5.3651,  4.8408,  5.4818,  4.9684,
         5.5352,  4.8600,  5.3598,  5.2805,  4.7273,  5.2681,  5.1862,  4.8741,
         6.1244,  4.9947,  4.8022,  5.2890,  5.3845,  5.3848,  4.8500,  5.4225,
         5.4326,  5.0902,  5.0501,  5.3514,  4.9791,  4.9934,  5.1794,  5.0232,
         5.1371,  4.9237,  5.2363,  5.1592,  5.1773,  4.7400,  5.0183,  5.1026,
         4.8805,  5.0828,  5.0041,  5.0514,  5.0015,  4.9805,  5.0425,  5.0113,
         4.7718,  5.4059,  5.8368,  5.2512,  4.9564,  4.7938,  4.9412,  5.0583,
         3.7544,  3.5479,  3.4127,  3.3172,  3.5192,  3.3689,  3.3090,  3.3855,
         3.3464,  3.5474,  3.5233,  3.7421,  3.2080,  3.3620,  3.6437,  3.7655,
         3.5452,  3.6274,  3.4878,  3.4713,  3.4370,  3.2487,  3.6719,  3.4904,
         3.9567,  3.5172,  4.0846,  3.6537,  3.5229,  3.3273,  3.4807,  3.3933,
         4.0879,  4.2058,  3.1810,  3.8335,  3.7478,  3.4756,  3.6530,  3.3921,
         3.7393,  4.0716,  3.5592,  3.6958,  3.9318,  3.6416,  3.7884,  3.7359,
         4.2145,  3.7957,  3.5027,  3.4411,  3.8185,  3.9053,  3.4424,  3.4980,
         4.2348,  3.9489,  3.8723,  3.9639,  3.7657,  3.3619,  3.8765,  3.7724,
         4.0542,  4.0018,  3.3779,  3.7096,  3.4295,  3.6336,  3.9768,  3.2659,
         3.6228,  4.0953,  3.4937,  3.5840,  3.9470,  3.1585,  3.7460,  3.6445,
         4.3199,  3.5632,  3.7224,  3.8371,  3.5846,  3.2623,  3.6370,  3.9358,
         3.7062,  4.0742,  3.6269,  3.7291,  3.8093,  3.3296,  3.4488,  3.6277],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 2563.2841796875
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([2.6279, 2.6002, 3.0257, 2.6496, 2.6449, 2.7767, 2.6356, 2.6908, 2.7152,
        2.7351, 2.6256, 2.6959, 2.6950, 2.7113, 2.7747, 2.6770, 2.3943, 2.5765,
        2.6097, 2.8265, 2.7293, 2.4747, 2.5886, 2.7500, 2.8224, 2.7605, 2.5485,
        2.6239, 2.6806, 2.7303, 2.6711, 2.8198, 2.7893, 2.8191, 2.8560, 2.7324,
        2.8363, 2.9350, 2.8980, 2.8776, 2.9160, 2.9051, 2.8330, 2.8533, 2.8091,
        2.8917, 2.8896, 2.9352, 2.5889, 2.8435, 2.8136, 3.0125, 2.6798, 2.6717,
        2.8824, 2.8443, 3.0633, 2.8891, 2.6700, 2.7396, 2.8717, 2.8805, 2.8810,
        3.0426, 3.4450, 3.4548, 3.6220, 3.5145, 3.6328, 3.6510, 3.4161, 3.3516,
        3.5837, 3.5599, 3.4184, 3.6312, 3.4828, 3.8229, 3.4918, 3.5293, 3.3118,
        3.4391, 3.4724, 3.6822, 3.5554, 3.2894, 3.4018, 3.5705, 3.6329, 3.5969,
        3.2185, 3.4868, 3.4676, 3.7351, 3.4645, 3.6789, 3.3911, 3.4664, 3.4269,
        3.4871, 3.4509, 3.5901, 3.4234, 3.4926, 3.4449, 3.4818, 3.4012, 3.5030,
        3.4888, 3.7369, 3.4544, 3.4968, 3.2257, 3.4147, 3.3520, 3.4637, 3.3762,
        3.3139, 3.4623, 3.5312, 3.6295, 3.4952, 3.1701, 3.5003, 3.4110, 3.4678,
        3.2815, 3.6590, 2.2591, 2.3406, 2.4031, 2.3256, 2.2791, 2.4241, 2.3938,
        2.3879, 2.3677, 2.3190, 2.3641, 2.3077, 2.3261, 2.5047, 2.3088, 2.3413,
        2.1363, 2.3325, 2.3001, 2.4094, 2.2837, 2.1661, 2.3764, 2.3359, 2.3287,
        2.3225, 2.1881, 2.3535, 2.3282, 2.3826, 2.3331, 2.2147, 2.4585, 2.5088,
        2.5300, 2.4349, 2.5082, 2.6059, 2.6960, 2.5066, 2.5338, 2.5086, 2.5764,
        2.4224, 2.5083, 2.7144, 2.4810, 2.4990, 2.3183, 2.4506, 2.4467, 2.6647,
        2.5565, 2.4109, 2.4673, 2.4309, 2.5846, 2.4786, 2.3444, 2.4818, 2.4820,
        2.5105, 2.4415, 2.3657, 3.0929, 3.1475, 3.0651, 2.9845, 3.1159, 3.1751,
        3.1785, 3.1467, 3.0648, 3.1795, 3.0579, 3.1652, 3.1164, 3.2659, 2.9585,
        2.9967, 3.0034, 3.0756, 3.0669, 3.1783, 3.0627, 3.0008, 2.9465, 3.0259,
        3.1686, 3.1933, 2.8826, 3.0891, 2.9943, 3.0300, 2.9248, 3.0313, 3.0268,
        3.1189, 3.0037, 3.0695, 3.0497, 3.2380, 3.1173, 3.1509, 2.9841, 3.2028,
        3.0827, 3.1120, 3.1109, 3.1088, 3.2004, 3.1136, 2.9391, 3.1505, 3.0641,
        3.1607, 3.0545, 2.9781, 3.1651, 3.0587, 3.2473, 3.2366, 2.8679, 3.1399,
        3.0878, 3.1354, 3.0677, 3.3134, 2.9914, 2.9431, 3.1849, 2.8543, 2.9106,
        3.1486, 3.0521, 3.0738, 3.0137, 3.1207, 3.1119, 3.0084, 3.0696, 3.1276,
        2.9988, 2.9916, 2.7902, 2.9859, 2.9167, 2.9888, 2.8814, 2.8806, 3.0344,
        2.7864, 2.9167, 3.0199, 2.8424, 3.0123, 2.8989, 3.1072, 3.0877, 3.1553,
        3.0922, 3.0665, 3.0384, 3.0037, 3.0593, 3.2144, 3.1351, 3.0850, 3.0274,
        3.0382, 3.1918, 3.0119, 3.1202, 3.0346, 3.0574, 2.9613, 2.9263, 3.0658,
        3.0108, 3.1406, 3.0930, 3.0672, 2.9686, 3.0066, 3.0391, 3.0548, 2.9631,
        3.0729, 3.1055, 3.0993, 2.9501, 3.1073, 3.5194, 3.4155, 3.3737, 3.4912,
        3.4112, 3.5780, 3.6360, 3.6170, 3.3696, 3.4804, 3.5041, 3.5827, 3.5262,
        3.4203, 3.5219, 3.4568, 3.3468, 3.4552, 3.4662, 3.4321, 3.3570, 3.5203,
        3.3949, 3.4641, 3.5730, 3.4583, 3.5373, 3.4542, 3.4991, 3.5315, 3.3862,
        3.3828, 3.6613, 3.8089, 3.6038, 3.7101, 3.7327, 3.9302, 3.6950, 3.9175,
        3.7780, 3.8230, 3.8385, 3.7544, 3.9588, 3.7839, 3.6616, 3.6418, 3.6530,
        3.7624, 3.5498, 3.7916, 3.7859, 3.7059, 3.6521, 3.6784, 3.7178, 3.8299,
        3.5419, 3.7464, 3.7362, 3.7467, 3.7747, 3.6827, 2.9401, 2.8904, 2.8877,
        2.8293, 2.8565, 2.9512, 2.8243, 2.8396, 2.9361, 2.8540, 2.9088, 2.9219,
        2.8652, 2.8212, 2.8422, 2.8431, 2.7227, 2.8363, 2.9387, 2.8193, 2.7333,
        2.7474, 2.8397, 2.8292, 2.7833, 2.8152, 2.8079, 2.7918, 2.8558, 2.9262,
        2.8421, 3.0127, 2.9538, 2.9079, 2.9417, 2.8649, 2.8817, 2.9919, 2.9379,
        2.9477, 2.8985, 2.9219, 2.9515, 2.8517, 3.0108, 2.8992, 2.8725, 2.8368,
        2.7345, 2.8701, 2.8598, 2.7997, 2.8973, 2.8866, 2.8726, 2.9008, 2.7725,
        2.8707, 2.7428, 2.8654, 2.9020, 2.9762, 2.8844, 3.0272, 3.3594, 3.4201,
        3.4236, 3.3678, 3.3236, 3.5013, 3.3770, 3.4393, 3.4286, 3.4149, 3.4626,
        3.4093, 3.3973, 3.2867, 3.2583, 3.3458, 3.1411, 3.3705, 3.4014, 3.2892,
        3.2845, 3.3200, 3.2910, 3.2712, 3.2058, 3.3287, 3.2381, 3.3165, 3.3784,
        3.4364, 3.4558, 3.5773, 3.5678, 3.5829, 3.5826, 3.7056, 3.5247, 3.6721,
        3.5865, 3.6936, 3.5778, 3.6507, 3.6910, 3.5494, 3.6411, 3.5608, 3.5284,
        3.6394, 3.3347, 3.5781, 3.4693, 3.5481, 3.5087, 3.6219, 3.5665, 3.5838,
        3.4506, 3.5757, 3.3639, 3.6318, 3.5351, 3.6320, 3.4972, 3.6907],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([ 6.9059,  6.7613,  9.1549,  7.0202,  6.9956,  7.7103,  6.9466,  7.2405,
         7.3723,  7.4806,  6.8938,  7.2677,  7.2629,  7.3511,  7.6988,  7.1665,
         5.7327,  6.6385,  6.8105,  7.9892,  7.4489,  6.1239,  6.7009,  7.5625,
         7.9661,  7.6203,  6.4947,  6.8847,  7.1858,  7.4547,  7.1349,  7.9515,
         7.7799,  7.9475,  8.1566,  7.4662,  8.0446,  8.6140,  8.3982,  8.2809,
         8.5031,  8.4395,  8.0260,  8.1415,  7.8911,  8.3620,  8.3497,  8.6152,
         6.7023,  8.0856,  7.9161,  9.0749,  7.1812,  7.1379,  8.3081,  8.0899,
         9.3841,  8.3470,  7.1290,  7.5051,  8.2469,  8.2974,  8.3001,  9.2571,
        11.8678, 11.9356, 13.1186, 12.3519, 13.1969, 13.3301, 11.6698, 11.2336,
        12.8428, 12.6727, 11.6858, 13.1857, 12.1302, 14.6145, 12.1929, 12.4558,
        10.9682, 11.8273, 12.0579, 13.5585, 12.6409, 10.8199, 11.5719, 12.7482,
        13.1981, 12.9374, 10.3585, 12.1577, 12.0246, 13.9508, 12.0028, 13.5346,
        11.4994, 12.0159, 11.7434, 12.1597, 11.9090, 12.8889, 11.7200, 12.1983,
        11.8670, 12.1230, 11.5679, 12.2709, 12.1715, 13.9642, 11.9332, 12.2279,
        10.4051, 11.6602, 11.2357, 11.9971, 11.3988, 10.9818, 11.9874, 12.4692,
        13.1730, 12.2167, 10.0498, 12.2518, 11.6349, 12.0254, 10.7683, 13.3882,
         5.1033,  5.4783,  5.7751,  5.4082,  5.1944,  5.8762,  5.7301,  5.7022,
         5.6062,  5.3778,  5.5888,  5.3256,  5.4107,  6.2737,  5.3308,  5.4817,
         4.5637,  5.4408,  5.2907,  5.8052,  5.2153,  4.6921,  5.6472,  5.4566,
         5.4227,  5.3938,  4.7879,  5.5389,  5.4206,  5.6767,  5.4434,  4.9049,
         6.0441,  6.2939,  6.4010,  5.9290,  6.2909,  6.7908,  7.2685,  6.2829,
         6.4203,  6.2931,  6.6380,  5.8678,  6.2913,  7.3679,  6.1552,  6.2452,
         5.3745,  6.0057,  5.9864,  7.1005,  6.5358,  5.8126,  6.0878,  5.9092,
         6.6802,  6.1436,  5.4961,  6.1592,  6.1604,  6.3025,  5.9608,  5.5963,
         9.5663,  9.9067,  9.3950,  8.9070,  9.7085, 10.0811, 10.1026,  9.9018,
         9.3931, 10.1094,  9.3506, 10.0182,  9.7119, 10.6663,  8.7526,  8.9801,
         9.0203,  9.4594,  9.4058, 10.1018,  9.3801,  9.0049,  8.6817,  9.1559,
        10.0401, 10.1970,  8.3094,  9.5424,  8.9657,  9.1809,  8.5546,  9.1890,
         9.1614,  9.7275,  9.0225,  9.4219,  9.3006, 10.4845,  9.7174,  9.9282,
         8.9047, 10.2582,  9.5030,  9.6845,  9.6780,  9.6649, 10.2428,  9.6945,
         8.6383,  9.9255,  9.3884,  9.9899,  9.3302,  8.8692, 10.0177,  9.3558,
        10.5452, 10.4759,  8.2248,  9.8590,  9.5347,  9.8309,  9.4108, 10.9789,
         8.9485,  8.6617, 10.1434,  8.1471,  8.4718,  9.9139,  9.3152,  9.4481,
         9.0821,  9.7388,  9.6840,  9.0505,  9.4222,  9.7817,  8.9928,  8.9495,
         7.7854,  8.9154,  8.5069,  8.9326,  8.3023,  8.2980,  9.2077,  7.7640,
         8.5072,  9.1200,  8.0795,  9.0737,  8.4035,  9.6546,  9.5338,  9.9561,
         9.5615,  9.4035,  9.2319,  9.0220,  9.3592, 10.3325,  9.8291,  9.5169,
         9.1653,  9.2309, 10.1875,  9.0718,  9.7354,  9.2091,  9.3476,  8.7695,
         8.5630,  9.3989,  9.0652,  9.8631,  9.5667,  9.4077,  8.8127,  9.0397,
         9.2364,  9.3320,  8.7801,  9.4424,  9.6439,  9.6055,  8.7030,  9.6552,
        12.3860, 11.6658, 11.3820, 12.1886, 11.6364, 12.8020, 13.2208, 13.0827,
        11.3543, 12.1132, 12.2788, 12.8360, 12.4338, 11.6986, 12.4035, 11.9494,
        11.2014, 11.9383, 12.0145, 11.7794, 11.2692, 12.3925, 11.5255, 11.9998,
        12.7664, 11.9601, 12.5122, 11.9313, 12.2439, 12.4715, 11.4664, 11.4436,
        13.4049, 14.5080, 12.9873, 13.7650, 13.9333, 15.4463, 13.6530, 15.3470,
        14.2731, 14.6150, 14.7339, 14.0953, 15.6724, 14.3179, 13.4072, 13.2630,
        13.3447, 14.1554, 12.6009, 14.3765, 14.3333, 13.7335, 13.3375, 13.5306,
        13.8217, 14.6685, 12.5449, 14.0354, 13.9593, 14.0379, 14.2482, 13.5621,
         8.6442,  8.3544,  8.3386,  8.0051,  8.1598,  8.7095,  7.9769,  8.0632,
         8.6207,  8.1456,  8.4611,  8.5374,  8.2095,  7.9590,  8.0783,  8.0831,
         7.4133,  8.0449,  8.6361,  7.9486,  7.4709,  7.5480,  8.0638,  8.0041,
         7.7465,  7.9251,  7.8845,  7.7939,  8.1554,  8.5626,  8.0777,  9.0762,
         8.7248,  8.4559,  8.6538,  8.2076,  8.3044,  8.9515,  8.6315,  8.6887,
         8.4011,  8.5375,  8.7111,  8.1323,  9.0648,  8.4053,  8.2514,  8.0476,
         7.4777,  8.2374,  8.1782,  7.8383,  8.3944,  8.3326,  8.2518,  8.4147,
         7.6865,  8.2410,  7.5228,  8.2103,  8.4214,  8.8577,  8.3197,  9.1637,
        11.2855, 11.6972, 11.7209, 11.3424, 11.0463, 12.2590, 11.4039, 11.8287,
        11.7550, 11.6615, 11.9897, 11.6233, 11.5416, 10.8027, 10.6165, 11.1946,
         9.8665, 11.3602, 11.5698, 10.8191, 10.7878, 11.0222, 10.8309, 10.7010,
        10.2770, 11.0804, 10.4850, 10.9990, 11.4133, 11.8087, 11.9428, 12.7968,
        12.7291, 12.8371, 12.8347, 13.7318, 12.4233, 13.4845, 12.8629, 13.6426,
        12.8005, 13.3280, 13.6232, 12.5983, 13.2574, 12.6791, 12.4495, 13.2455,
        11.1200, 12.8030, 12.0357, 12.5892, 12.3113, 13.1183, 12.7198, 12.8435,
        11.9069, 12.7853, 11.3160, 13.1897, 12.4969, 13.1917, 12.2305, 13.6213],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 4974.1123046875
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([3.5232, 3.5266, 3.0536, 3.3831, 3.5212, 3.3583, 3.5587, 3.5849, 3.3350,
        3.3946, 3.3997, 3.5191, 3.4616, 3.6873, 3.2577, 3.4503, 3.9945, 3.5295,
        3.4106, 3.4500, 3.3545, 3.7317, 3.4143, 3.2960, 3.3071, 3.2599, 3.5828,
        3.4524, 3.3697, 3.5141, 3.2592, 3.2655, 2.9868, 2.8923, 2.7790, 2.7901,
        2.8331, 2.8996, 2.8984, 2.8896, 2.9147, 2.8722, 2.9084, 2.9669, 2.8962,
        2.8847, 2.8322, 2.8422, 3.1280, 2.8842, 2.9525, 2.8024, 2.8232, 3.0054,
        2.8725, 2.8288, 2.7635, 2.7984, 2.8749, 2.8926, 2.9340, 2.8921, 2.8799,
        2.7465, 3.5057, 3.4660, 3.3513, 3.4220, 3.3621, 3.4166, 3.5656, 3.5308,
        3.3343, 3.4237, 3.5140, 3.4051, 3.3540, 3.2086, 3.3553, 3.3198, 3.4707,
        3.5340, 3.3859, 3.3251, 3.3771, 3.6976, 3.4093, 3.2758, 3.3171, 3.4180,
        3.4501, 3.2869, 3.4692, 3.3529, 3.3252, 3.3341, 3.4870, 3.2734, 3.3448,
        3.1593, 3.3059, 3.3289, 3.4130, 3.3454, 3.2912, 3.2568, 3.3456, 3.3130,
        3.3117, 3.0056, 3.1072, 3.2247, 3.4975, 3.3851, 3.2570, 3.3470, 3.1834,
        3.5791, 3.1860, 3.2677, 3.1554, 3.2092, 3.7064, 3.1976, 3.2875, 3.3348,
        3.2212, 3.1115, 3.4843, 3.3619, 3.2935, 3.3709, 3.6124, 3.3356, 3.4834,
        3.4601, 3.4116, 3.4849, 3.3579, 3.4518, 3.4362, 3.2544, 3.4084, 3.2172,
        3.7406, 3.4850, 3.4202, 3.3875, 3.4373, 3.6950, 3.3982, 3.3761, 3.3377,
        3.3908, 3.1610, 3.4402, 3.4631, 3.4171, 3.3119, 3.8289, 2.5551, 2.5541,
        2.6513, 2.6323, 2.5179, 2.4724, 2.4288, 2.5349, 2.5659, 2.6059, 2.6267,
        2.6811, 2.4517, 2.4997, 2.5567, 2.5713, 2.5930, 2.6150, 2.6078, 2.5056,
        2.5508, 2.6562, 2.5173, 2.5850, 2.5072, 2.5265, 2.5528, 2.5121, 2.6424,
        2.5630, 2.5056, 2.9181, 3.6461, 3.4584, 3.4805, 3.4078, 3.4671, 3.3656,
        3.2827, 3.5482, 3.4995, 3.5202, 3.5104, 3.4417, 3.3481, 3.4402, 3.4479,
        3.4807, 3.4614, 3.4735, 3.4438, 3.3705, 3.4736, 3.5401, 3.5534, 3.3681,
        3.3667, 3.4356, 3.2569, 3.3620, 3.6252, 3.6646, 3.4023, 3.5594, 3.5011,
        3.2810, 3.3887, 3.2801, 3.4413, 3.1741, 3.3413, 3.3636, 3.3359, 3.2546,
        3.3785, 3.4033, 3.2113, 3.3379, 3.1769, 3.2680, 3.4174, 3.3451, 3.2416,
        3.2694, 3.3464, 3.5788, 3.4513, 3.3946, 3.1371, 3.2429, 3.9061, 3.1547,
        3.3955, 3.2582, 3.1354, 2.9569, 2.5115, 2.7697, 2.5388, 2.7134, 2.8908,
        2.5305, 2.6187, 2.7493, 2.5636, 2.7196, 2.6126, 2.5797, 2.5422, 2.6855,
        2.6319, 2.7034, 2.7542, 2.7781, 2.7036, 2.8565, 2.5524, 2.7840, 2.7110,
        2.6324, 2.8117, 2.6324, 2.5006, 2.6438, 2.5593, 2.7064, 2.7208, 2.4226,
        2.1605, 2.1328, 2.2211, 2.2079, 2.1477, 2.1186, 2.1309, 2.1845, 2.1859,
        2.1578, 2.1464, 2.2400, 2.1484, 2.2669, 2.1663, 2.1863, 2.3142, 2.1853,
        2.1902, 2.2043, 2.1763, 2.1983, 2.2205, 2.1677, 2.1585, 2.1261, 2.1747,
        2.1415, 2.2239, 2.1765, 2.2173, 2.1588, 2.8247, 2.7679, 2.9272, 2.6559,
        2.8981, 2.5800, 2.5254, 2.5906, 2.6727, 2.6599, 2.7054, 2.7774, 2.7015,
        2.7749, 2.7011, 2.8801, 2.7208, 2.6358, 2.6659, 2.6252, 2.6676, 2.7002,
        2.6858, 2.5921, 2.6704, 2.7466, 2.4940, 2.6816, 2.6384, 2.8129, 2.6794,
        3.0424, 2.6970, 2.5986, 2.7702, 2.5980, 2.6839, 2.4366, 2.6019, 2.5649,
        2.4853, 2.5782, 2.6648, 2.5970, 2.5358, 2.7348, 2.6678, 2.5593, 2.7584,
        2.5868, 2.6378, 2.5735, 2.5996, 2.6782, 2.6743, 2.5883, 2.3994, 2.5569,
        3.0854, 2.5402, 2.5717, 2.6414, 2.5991, 2.5856, 2.7933, 2.8210, 2.8579,
        2.8602, 3.1965, 2.8304, 2.9181, 2.9982, 2.8547, 3.1635, 2.8045, 2.9723,
        2.9101, 3.1738, 2.9705, 3.0086, 3.0310, 2.9581, 2.8531, 3.2348, 2.7097,
        3.0583, 2.8613, 2.8924, 3.3053, 2.8907, 2.8142, 2.9525, 2.9652, 2.9255,
        2.8548, 2.8593, 2.3868, 2.5238, 2.4933, 2.4889, 2.6448, 2.4746, 2.4951,
        2.4805, 2.5560, 2.4980, 2.4546, 2.5597, 2.4216, 2.5438, 2.4849, 2.5681,
        2.5092, 2.5949, 2.4773, 2.6572, 2.5197, 2.5563, 2.5196, 2.3658, 2.7953,
        2.4433, 2.4734, 2.5794, 2.5655, 2.5719, 2.4446, 2.4149, 3.0417, 2.9949,
        3.0243, 3.0622, 3.2790, 2.9250, 2.9708, 3.0539, 2.9469, 3.0825, 2.9762,
        3.1231, 2.9647, 3.2625, 2.9931, 3.1755, 3.1874, 2.9463, 3.1054, 3.2696,
        3.1866, 3.0167, 3.1152, 2.8966, 3.4588, 3.0193, 3.0092, 3.0776, 2.9907,
        3.1303, 3.1101, 2.8326, 2.9073, 2.8548, 2.8981, 2.8901, 2.9857, 2.7032,
        2.9753, 2.8607, 2.9339, 2.8488, 2.7981, 2.9855, 2.8679, 3.1141, 2.9827,
        2.8225, 3.0290, 2.9503, 2.7488, 3.0140, 2.8973, 2.9234, 2.7638, 2.8224,
        3.1995, 2.8390, 3.3697, 2.9470, 2.8549, 2.9520, 2.5804, 2.7022],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([12.4129, 12.4372,  9.3245, 11.4452, 12.3990, 11.2783, 12.6643, 12.8518,
        11.1225, 11.5231, 11.5578, 12.3843, 11.9825, 13.5961, 10.6125, 11.9049,
        15.9563, 12.4575, 11.6324, 11.9025, 11.2527, 13.9256, 11.6578, 10.8636,
        10.9366, 10.6270, 12.8364, 11.9191, 11.3551, 12.3492, 10.6227, 10.6635,
         8.9210,  8.3652,  7.7229,  7.7847,  8.0265,  8.4075,  8.4005,  8.3498,
         8.4953,  8.2496,  8.4588,  8.8027,  8.3878,  8.3216,  8.0211,  8.0783,
         9.7842,  8.3188,  8.7170,  7.8535,  7.9707,  9.0325,  8.2515,  8.0020,
         7.6368,  7.8312,  8.2650,  8.3669,  8.6086,  8.3642,  8.2939,  7.5434,
        12.2896, 12.0134, 11.2312, 11.7101, 11.3037, 11.6734, 12.7133, 12.4663,
        11.1173, 11.7218, 12.3480, 11.5950, 11.2493, 10.2953, 11.2582, 11.0213,
        12.0457, 12.4892, 11.4645, 11.0565, 11.4049, 13.6722, 11.6236, 10.7308,
        11.0034, 11.6829, 11.9029, 10.8036, 12.0354, 11.2422, 11.0566, 11.1164,
        12.1593, 10.7150, 11.1878,  9.9809, 10.9289, 11.0818, 11.6483, 11.1917,
        10.8321, 10.6066, 11.1931, 10.9762, 10.9673,  9.0338,  9.6546, 10.3990,
        12.2324, 11.4591, 10.6080, 11.2025, 10.1337, 12.8101, 10.1508, 10.6777,
         9.9564, 10.2990, 13.7377, 10.2245, 10.8075, 11.1212, 10.3761,  9.6814,
        12.1402, 11.3022, 10.8471, 11.3630, 13.0494, 11.1261, 12.1340, 11.9721,
        11.6388, 12.1443, 11.2754, 11.9146, 11.8074, 10.5913, 11.6174, 10.3501,
        13.9923, 12.1452, 11.6979, 11.4754, 11.8149, 13.6529, 11.5478, 11.3982,
        11.1400, 11.4976,  9.9919, 11.8350, 11.9933, 11.6769, 10.9685, 14.6603,
         6.5286,  6.5233,  7.0295,  6.9289,  6.3398,  6.1127,  5.8989,  6.4255,
         6.5841,  6.7905,  6.8993,  7.1883,  6.0108,  6.2484,  6.5365,  6.6115,
         6.7237,  6.8381,  6.8007,  6.2782,  6.5063,  7.0552,  6.3366,  6.6824,
         6.2860,  6.3834,  6.5170,  6.3105,  6.9822,  6.5690,  6.2779,  8.5155,
        13.2940, 11.9606, 12.1140, 11.6134, 12.0206, 11.3274, 10.7762, 12.5897,
        12.2466, 12.3916, 12.3228, 11.8452, 11.2094, 11.8349, 11.8881, 12.1150,
        11.9811, 12.0655, 11.8598, 11.3603, 12.0657, 12.5325, 12.6264, 11.3440,
        11.3344, 11.8033, 10.6076, 11.3032, 13.1418, 13.4296, 11.5755, 12.6697,
        12.2580, 10.7648, 11.4835, 10.7590, 11.8428, 10.0748, 11.1640, 11.3139,
        11.1284, 10.5922, 11.4144, 11.5827, 10.3127, 11.1415, 10.0926, 10.6798,
        11.6784, 11.1899, 10.5082, 10.6890, 11.1985, 12.8077, 11.9117, 11.5235,
         9.8414, 10.5166, 15.2576,  9.9522, 11.5293, 10.6157,  9.8304,  8.7434,
         6.3078,  7.6712,  6.4456,  7.3626,  8.3568,  6.4034,  6.8578,  7.5584,
         6.5723,  7.3961,  6.8255,  6.6551,  6.4630,  7.2119,  6.9268,  7.3083,
         7.5854,  7.7178,  7.3095,  8.1597,  6.5149,  7.7508,  7.3496,  6.9296,
         7.9056,  6.9293,  6.2529,  6.9899,  6.5503,  7.3247,  7.4026,  5.8691,
         4.6677,  4.5486,  4.9332,  4.8749,  4.6128,  4.4883,  4.5408,  4.7721,
         4.7780,  4.6562,  4.6071,  5.0178,  4.6156,  5.1389,  4.6929,  4.7800,
         5.3557,  4.7756,  4.7972,  4.8590,  4.7361,  4.8324,  4.9307,  4.6989,
         4.6591,  4.5204,  4.7295,  4.5861,  4.9459,  4.7370,  4.9163,  4.6603,
         7.9788,  7.6612,  8.5682,  7.0539,  8.3988,  6.6562,  6.3775,  6.7111,
         7.1433,  7.0749,  7.3192,  7.7140,  7.2981,  7.7000,  7.2958,  8.2953,
         7.4025,  6.9477,  7.1068,  6.8918,  7.1161,  7.2913,  7.2134,  6.7189,
         7.1310,  7.5439,  6.2198,  7.1912,  6.9612,  7.9126,  7.1790,  9.2561,
         7.2738,  6.7528,  7.6740,  6.7497,  7.2035,  5.9370,  6.7700,  6.5788,
         6.1770,  6.6471,  7.1013,  6.7444,  6.4301,  7.4789,  7.1170,  6.5502,
         7.6090,  6.6915,  6.9580,  6.6231,  6.7577,  7.1727,  7.1521,  6.6995,
         5.7571,  6.5377,  9.5197,  6.4527,  6.6135,  6.9769,  6.7554,  6.6851,
         7.8023,  7.9579,  8.1675,  8.1807, 10.2176,  8.0113,  8.5150,  8.9890,
         8.1491, 10.0077,  7.8650,  8.8347,  8.4689, 10.0729,  8.8240,  9.0515,
         9.1868,  8.7501,  8.1402, 10.4638,  7.3427,  9.3534,  8.1870,  8.3662,
        10.9251,  8.3562,  7.9199,  8.7173,  8.7926,  8.5585,  8.1497,  8.1756,
         5.6970,  6.3694,  6.2167,  6.1945,  6.9948,  6.1238,  6.2256,  6.1527,
         6.5333,  6.2398,  6.0250,  6.5521,  5.8643,  6.4709,  6.1748,  6.5954,
         6.2963,  6.7333,  6.1370,  7.0609,  6.3490,  6.5348,  6.3483,  5.5970,
         7.8137,  5.9699,  6.1178,  6.6535,  6.5818,  6.6146,  5.9758,  5.8317,
         9.2519,  8.9695,  9.1466,  9.3772, 10.7518,  8.5554,  8.8257,  9.3264,
         8.6845,  9.5017,  8.8575,  9.7540,  8.7897, 10.6441,  8.9585, 10.0837,
        10.1598,  8.6806,  9.6436, 10.6906, 10.1546,  9.1007,  9.7044,  8.3901,
        11.9636,  9.1159,  9.0550,  9.4719,  8.9442,  9.7989,  9.6728,  8.0237,
         8.4522,  8.1498,  8.3989,  8.3524,  8.9144,  7.3072,  8.8526,  8.1838,
         8.6079,  8.1155,  7.8294,  8.9133,  8.2248,  9.6977,  8.8966,  7.9662,
         9.1746,  8.7040,  7.5558,  9.0841,  8.3942,  8.5461,  7.6385,  7.9662,
        10.2368,  8.0601, 11.3546,  8.6845,  8.1505,  8.7143,  6.6582,  7.3019],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 4581.07861328125
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([2.7262, 2.6936, 2.4980, 2.5410, 2.7164, 2.5947, 2.7475, 2.7207, 2.5592,
        2.5856, 2.6441, 2.6447, 2.6433, 2.7856, 2.6064, 2.6297, 2.8509, 2.6822,
        2.6760, 2.6535, 2.6291, 2.6635, 2.6465, 2.5798, 2.6547, 2.5864, 2.6840,
        2.6650, 2.6054, 2.5711, 2.5776, 2.5439, 2.1977, 2.2261, 2.2455, 2.2945,
        2.2248, 2.1916, 2.1849, 2.2377, 2.1820, 2.2136, 2.2374, 2.1152, 2.1711,
        2.1861, 2.1459, 2.2474, 2.2744, 2.2584, 2.1793, 2.1433, 2.2871, 2.2521,
        2.2155, 2.2697, 2.1258, 2.1152, 2.0724, 2.2266, 2.2681, 2.2133, 2.1577,
        2.2039, 2.8335, 2.7078, 2.7852, 2.7528, 2.7485, 2.8680, 2.9596, 2.7648,
        2.7385, 2.7378, 2.6797, 2.7476, 2.6921, 2.7447, 2.6918, 2.7564, 2.6647,
        2.8153, 2.8308, 2.7201, 2.8250, 2.9210, 2.7836, 2.6323, 2.7961, 2.7657,
        2.5761, 2.6219, 2.8444, 2.7563, 2.6840, 2.7486, 2.4788, 2.4383, 2.1862,
        2.3602, 2.3902, 2.4273, 2.4473, 2.2640, 2.1780, 2.3098, 2.2233, 2.3354,
        2.2628, 2.2337, 2.1604, 2.2581, 2.3485, 2.3080, 2.2812, 2.2677, 2.2536,
        2.4325, 2.3363, 2.1588, 2.2911, 2.1748, 2.4099, 2.0596, 2.2266, 2.2667,
        2.2272, 2.2137, 2.8069, 2.7032, 2.6627, 2.8191, 2.7866, 2.7293, 2.7395,
        2.7297, 2.7685, 2.6794, 2.6943, 2.7420, 2.7894, 2.7170, 2.7222, 2.7394,
        2.8919, 2.7330, 2.7120, 2.7256, 2.7251, 2.8676, 2.7433, 2.7415, 2.7067,
        2.7093, 2.6445, 2.7084, 2.7317, 2.8527, 2.6642, 2.8669, 2.5051, 2.4102,
        2.3934, 2.4646, 2.3860, 2.3480, 2.3392, 2.3774, 2.3806, 2.4163, 2.4162,
        2.3441, 2.3856, 2.3534, 2.3719, 2.3767, 2.4023, 2.4001, 2.3024, 2.3785,
        2.4159, 2.4241, 2.3395, 2.3996, 2.3850, 2.4342, 2.3336, 2.3566, 2.3969,
        2.3455, 2.4382, 2.4636, 2.9580, 2.9561, 2.9052, 2.9220, 2.9432, 2.9849,
        2.9503, 2.9683, 2.8532, 2.9905, 2.9093, 2.9912, 2.9160, 2.9817, 2.9767,
        2.9148, 2.8370, 2.9944, 2.9810, 2.8926, 2.9307, 2.8440, 2.9814, 2.9154,
        2.9463, 2.9325, 2.8000, 2.8648, 2.9792, 2.9280, 2.9440, 2.9205, 2.6287,
        2.4701, 2.4935, 2.4052, 2.5185, 2.4983, 2.5636, 2.4843, 2.4818, 2.5162,
        2.4489, 2.4556, 2.4611, 2.3924, 2.3474, 2.4686, 2.3267, 2.5106, 2.5434,
        2.4719, 2.4305, 2.4946, 2.3198, 2.3286, 2.4987, 2.4187, 2.5373, 2.3379,
        2.5667, 2.5832, 2.3902, 2.4853, 3.1363, 3.1781, 3.1174, 3.1477, 3.3217,
        3.1929, 3.2253, 3.2637, 3.1406, 3.2289, 3.2008, 3.1979, 3.1842, 3.2462,
        3.1346, 3.1976, 3.3266, 3.1728, 3.1617, 3.2651, 3.1811, 3.2315, 3.1265,
        3.1769, 3.2775, 3.1592, 3.0931, 3.1991, 3.0962, 3.2096, 3.1794, 3.1414,
        2.8553, 2.8497, 2.9020, 2.8438, 2.8189, 2.7606, 2.7869, 2.8010, 2.7725,
        2.7519, 2.8203, 2.8176, 2.8167, 2.9681, 2.7251, 2.8862, 2.8398, 2.8388,
        2.7562, 2.8437, 2.7516, 2.8219, 2.7165, 2.7286, 2.8182, 2.7942, 2.7845,
        2.7935, 2.7911, 2.8842, 2.8523, 2.8385, 3.3521, 3.2075, 3.2639, 3.1630,
        3.3847, 3.2307, 3.2324, 3.2096, 3.1993, 3.1944, 3.2931, 3.2385, 3.1884,
        3.3012, 3.2404, 3.3415, 3.2349, 3.2386, 3.1930, 3.2185, 3.3263, 3.2306,
        3.3201, 3.1482, 3.2820, 3.2317, 3.1091, 3.2626, 3.2474, 3.2832, 3.1559,
        3.3314, 2.9269, 2.8075, 2.8588, 2.7563, 2.8137, 2.7148, 2.9595, 2.7818,
        2.7239, 2.7065, 2.8358, 2.8288, 2.7734, 2.8856, 2.7483, 2.8262, 2.7068,
        2.8671, 2.9103, 2.7318, 2.7781, 2.8125, 2.6658, 2.7125, 2.8046, 2.7743,
        2.9074, 2.7794, 2.7153, 2.9541, 2.7408, 2.8274, 2.7137, 2.8110, 2.8030,
        2.6733, 2.8540, 2.8501, 2.8458, 2.8624, 2.7604, 2.8092, 2.8564, 2.7141,
        2.8854, 2.9205, 2.8306, 2.7458, 2.9124, 2.7672, 2.7597, 2.8329, 2.7638,
        2.9747, 2.7447, 2.7620, 2.8423, 2.8277, 2.7911, 2.7881, 2.7414, 2.9054,
        2.6604, 2.7762, 2.5618, 2.6094, 2.6421, 2.6126, 2.6424, 2.6183, 2.5966,
        2.5475, 2.6009, 2.4906, 2.5403, 2.6136, 2.5779, 2.6150, 2.6110, 2.5957,
        2.7002, 2.5015, 2.6743, 2.6423, 2.4516, 2.7532, 2.5472, 2.5330, 2.6629,
        2.6191, 2.6826, 2.5927, 2.6159, 2.6843, 2.5855, 2.5742, 3.2106, 3.1155,
        3.0424, 3.0138, 3.0743, 3.1835, 3.2212, 3.0889, 3.0966, 3.0483, 3.0753,
        3.0484, 3.0976, 3.1379, 3.1274, 3.1258, 3.1465, 3.0301, 3.0151, 2.9896,
        3.0390, 3.1160, 3.0661, 3.1173, 3.1928, 3.2174, 3.0617, 3.1117, 3.0396,
        3.2165, 2.9862, 3.0601, 2.8176, 2.7066, 2.5529, 2.5228, 2.7922, 2.6633,
        2.7216, 2.6332, 2.5982, 2.5415, 2.6166, 2.7034, 2.7130, 2.6591, 2.6267,
        2.5819, 2.7371, 2.5121, 2.6535, 2.5560, 2.6565, 2.8010, 2.5635, 2.5451,
        2.6885, 2.7232, 2.7223, 2.6102, 2.5922, 2.7726, 2.6465, 2.6533],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([ 7.4324,  7.2554,  6.2401,  6.4567,  7.3791,  6.7324,  7.5489,  7.4024,
         6.5497,  6.6856,  6.9911,  6.9946,  6.9871,  7.7597,  6.7935,  6.9151,
         8.1275,  7.1940,  7.1610,  7.0411,  6.9121,  7.0941,  7.0040,  6.6555,
         7.0475,  6.6895,  7.2041,  7.1021,  6.7879,  6.6105,  6.6439,  6.4714,
         4.8298,  4.9555,  5.0423,  5.2646,  4.9496,  4.8030,  4.7738,  5.0075,
         4.7612,  4.9001,  5.0058,  4.4742,  4.7136,  4.7789,  4.6049,  5.0507,
         5.1730,  5.1002,  4.7491,  4.5938,  5.2310,  5.0720,  4.9083,  5.1515,
         4.5192,  4.4739,  4.2949,  4.9576,  5.1441,  4.8985,  4.6556,  4.8572,
         8.0289,  7.3324,  7.7574,  7.5780,  7.5540,  8.2254,  8.7592,  7.6444,
         7.4993,  7.4958,  7.1809,  7.5493,  7.2471,  7.5333,  7.2461,  7.5975,
         7.1008,  7.9261,  8.0134,  7.3987,  7.9807,  8.5322,  7.7486,  6.9292,
         7.8180,  7.6490,  6.6365,  6.8741,  8.0906,  7.5973,  7.2039,  7.5551,
         6.1443,  5.9454,  4.7796,  5.5707,  5.7132,  5.8917,  5.9892,  5.1255,
         4.7435,  5.3354,  4.9429,  5.4542,  5.1203,  4.9893,  4.6672,  5.0991,
         5.5154,  5.3267,  5.2041,  5.1426,  5.0788,  5.9170,  5.4582,  4.6602,
         5.2490,  4.7299,  5.8075,  4.2421,  4.9577,  5.1381,  4.9603,  4.9004,
         7.8788,  7.3073,  7.0902,  7.9476,  7.7652,  7.4492,  7.5051,  7.4513,
         7.6644,  7.1792,  7.2594,  7.5185,  7.7809,  7.3821,  7.4103,  7.5045,
         8.3631,  7.4696,  7.3552,  7.4289,  7.4264,  8.2232,  7.5259,  7.5158,
         7.3260,  7.3401,  6.9932,  7.3355,  7.4621,  8.1380,  7.0980,  8.2192,
         6.2754,  5.8089,  5.7284,  6.0743,  5.6930,  5.5133,  5.4719,  5.6522,
         5.6674,  5.8385,  5.8381,  5.4949,  5.6911,  5.5384,  5.6261,  5.6487,
         5.7712,  5.7605,  5.3013,  5.6575,  5.8366,  5.8761,  5.4733,  5.7583,
         5.6882,  5.9251,  5.4459,  5.5535,  5.7449,  5.5013,  5.9449,  6.0692,
         8.7495,  8.7387,  8.4404,  8.5382,  8.6627,  8.9099,  8.7042,  8.8107,
         8.1405,  8.9433,  8.4642,  8.9470,  8.5028,  8.8906,  8.8605,  8.4962,
         8.0484,  8.9664,  8.8862,  8.3670,  8.5891,  8.0882,  8.8890,  8.4995,
         8.6804,  8.5995,  7.8399,  8.2072,  8.8757,  8.5730,  8.6673,  8.5295,
         6.9098,  6.1013,  6.2176,  5.7847,  6.3428,  6.2413,  6.5722,  6.1718,
         6.1592,  6.3310,  5.9972,  6.0300,  6.0570,  5.7234,  5.5104,  6.0939,
         5.4137,  6.3029,  6.4688,  6.1104,  5.9075,  6.2229,  5.3816,  5.4223,
         6.2435,  5.8503,  6.4379,  5.4657,  6.5881,  6.6730,  5.7132,  6.1769,
         9.8364, 10.1001,  9.7182,  9.9078, 11.0338, 10.1944, 10.4022, 10.6516,
         9.8636, 10.4256, 10.2451, 10.2267, 10.1391, 10.5376,  9.8254, 10.2249,
        11.0661, 10.0669,  9.9962, 10.6612, 10.1196, 10.4425,  9.7748, 10.0930,
        10.7419,  9.9804,  9.5670, 10.2344,  9.5867, 10.3016, 10.1086,  9.8684,
         8.1528,  8.1206,  8.4215,  8.0872,  7.9461,  7.6207,  7.7666,  7.8456,
         7.6868,  7.5728,  7.9539,  7.9387,  7.9337,  8.8096,  7.4264,  8.3300,
         8.0642,  8.0588,  7.5967,  8.0864,  7.5711,  7.9630,  7.3796,  7.4454,
         7.9422,  7.8077,  7.7537,  7.8039,  7.7902,  8.3185,  8.1355,  8.0570,
        11.2366, 10.2882, 10.6529, 10.0044, 11.4561, 10.4374, 10.4484, 10.3015,
        10.2358, 10.2045, 10.8448, 10.4877, 10.1661, 10.8978, 10.4999, 11.1654,
        10.4646, 10.4884, 10.1952, 10.3585, 11.0641, 10.4366, 11.0233,  9.9114,
        10.7716, 10.4439,  9.6663, 10.6448, 10.5458, 10.7793,  9.9595, 11.0984,
         8.5666,  7.8822,  8.1730,  7.5971,  7.9168,  7.3702,  8.7589,  7.7383,
         7.4194,  7.3250,  8.0417,  8.0019,  7.6917,  8.3268,  7.5530,  7.9876,
         7.3266,  8.2202,  8.4701,  7.4629,  7.7176,  7.9101,  7.1066,  7.3578,
         7.8658,  7.6966,  8.4532,  7.7248,  7.3727,  8.7269,  7.5119,  7.9939,
         7.3642,  7.9015,  7.8566,  7.1463,  8.1456,  8.1228,  8.0987,  8.1933,
         7.6197,  7.8919,  8.1590,  7.3662,  8.3256,  8.5295,  8.0124,  7.5393,
         8.4819,  7.6576,  7.6161,  8.0253,  7.6387,  8.8490,  7.5336,  7.6285,
         8.0786,  7.9960,  7.7903,  7.7733,  7.5155,  8.4412,  7.0776,  7.7071,
         6.5626,  6.8089,  6.9808,  6.8255,  6.9825,  6.8555,  6.7422,  6.4898,
         6.7647,  6.2032,  6.4533,  6.8307,  6.6457,  6.8384,  6.8174,  6.7376,
         7.2909,  6.2575,  7.1521,  6.9816,  6.0101,  7.5800,  6.4881,  6.4160,
         7.0910,  6.8595,  7.1964,  6.7219,  6.8428,  7.2056,  6.6847,  6.6263,
        10.3082,  9.7066,  9.2564,  9.0831,  9.4516, 10.1346, 10.3764,  9.5410,
         9.5889,  9.2920,  9.4576,  9.2926,  9.5950,  9.8465,  9.7804,  9.7706,
         9.9007,  9.1818,  9.0911,  8.9377,  9.2354,  9.7093,  9.4010,  9.7175,
        10.1940, 10.3516,  9.3740,  9.6828,  9.2391, 10.3457,  8.9176,  9.3643,
         7.9391,  7.3259,  6.5175,  6.3643,  7.7962,  7.0930,  7.4071,  6.9339,
         6.7508,  6.4592,  6.8467,  7.3082,  7.3601,  7.0711,  6.8997,  6.6663,
         7.4918,  6.3107,  7.0412,  6.5331,  7.0571,  7.8454,  6.5714,  6.4776,
         7.2282,  7.4156,  7.4111,  6.8133,  6.7198,  7.6874,  7.0038,  7.0399],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 3853.873046875
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([2.3568, 2.4053, 2.3463, 2.2136, 2.2474, 2.3500, 2.2713, 2.4191, 2.4027,
        2.1954, 2.3080, 2.3313, 2.5595, 2.3504, 2.2620, 2.2643, 2.2539, 2.3383,
        2.2387, 2.4287, 2.3741, 2.2892, 2.3729, 2.4775, 2.3396, 2.2840, 2.0779,
        2.3795, 2.4379, 2.3711, 2.3075, 2.5361, 2.5569, 2.6543, 2.5320, 2.5873,
        2.5224, 2.7230, 2.7081, 2.7119, 2.6412, 2.5240, 2.5780, 2.6866, 2.7391,
        2.6529, 2.6583, 2.5284, 2.5611, 2.6715, 2.4615, 2.6993, 2.6086, 2.6087,
        2.5733, 2.6571, 2.8082, 2.6681, 2.7702, 2.5289, 2.7845, 2.5280, 2.6549,
        2.7810, 2.6575, 2.7276, 2.7546, 2.6780, 2.6165, 2.8379, 2.6885, 2.8611,
        2.7724, 2.6914, 2.7198, 2.7683, 2.8503, 2.8364, 2.7420, 2.7104, 2.6600,
        2.7221, 2.7199, 2.7614, 2.8420, 2.7184, 2.6756, 2.7995, 2.7626, 2.6714,
        2.7116, 2.7881, 2.8544, 2.7125, 2.8567, 2.8591, 2.7393, 2.6609, 2.7484,
        2.7354, 2.7097, 2.8924, 2.6800, 2.8690, 2.8087, 2.6755, 2.7645, 2.7465,
        2.9454, 2.8854, 2.8201, 2.7391, 2.5003, 2.8501, 2.7984, 2.7659, 2.7965,
        2.5950, 2.6585, 2.7642, 2.8586, 2.7216, 2.5555, 2.7652, 2.8345, 2.7648,
        2.7307, 2.8886, 2.3211, 2.4304, 2.2980, 2.3102, 2.2964, 2.3810, 2.2683,
        2.4140, 2.2810, 2.2247, 2.3738, 2.2475, 2.5946, 2.3705, 2.3770, 2.3243,
        2.3660, 2.3086, 2.3808, 2.3499, 2.3903, 2.3431, 2.2579, 2.3403, 2.2648,
        2.3383, 2.1896, 2.2955, 2.5114, 2.4788, 2.3742, 2.3468, 2.6450, 2.7375,
        2.6719, 2.5239, 2.6265, 2.8079, 2.6559, 2.7399, 2.6887, 2.4791, 2.6623,
        2.5579, 2.7668, 2.7364, 2.6221, 2.5890, 2.6571, 2.6415, 2.6268, 2.8067,
        2.6652, 2.5785, 2.6145, 2.5525, 2.5762, 2.7411, 2.6701, 2.6500, 2.6474,
        2.5996, 2.6332, 2.6026, 2.6568, 2.8247, 2.6850, 2.7574, 2.6818, 2.8490,
        2.7723, 2.8046, 2.7452, 2.6872, 2.7915, 2.7487, 2.8713, 2.7435, 2.7274,
        2.6928, 2.8832, 2.7847, 2.6813, 2.7929, 2.6615, 2.7850, 2.7102, 2.6037,
        2.6839, 2.6894, 2.8414, 2.7150, 2.7057, 2.7550, 2.7326, 2.7684, 2.6024,
        2.7384, 2.6506, 2.7491, 2.6486, 2.8818, 2.5657, 2.7593, 2.6732, 2.6705,
        2.7000, 2.6136, 2.8395, 2.7826, 2.8228, 2.6389, 2.7121, 2.7266, 2.7180,
        2.6788, 2.5974, 2.5620, 2.7894, 2.6753, 2.6865, 2.6887, 2.4691, 2.7426,
        2.7622, 2.7605, 2.7100, 2.8799, 2.0010, 2.0866, 2.0165, 1.9444, 2.2005,
        2.0727, 2.0714, 2.1079, 2.0728, 1.9896, 2.0249, 1.9344, 2.1384, 2.0248,
        1.9451, 1.9750, 2.0396, 2.0682, 2.1021, 2.0185, 1.9452, 2.0497, 1.9544,
        2.0667, 1.9320, 2.0164, 1.8825, 1.9810, 2.0288, 2.1828, 2.0208, 2.1596,
        2.2556, 2.3366, 2.2609, 2.3591, 2.3336, 2.3943, 2.3921, 2.3515, 2.3261,
        2.3671, 2.4165, 2.1885, 2.3625, 2.2608, 2.2854, 2.2593, 2.3730, 2.2714,
        2.3352, 2.3124, 2.3108, 2.3856, 2.3600, 2.3074, 2.1793, 2.2816, 2.2012,
        2.1661, 2.3683, 2.3349, 2.2248, 2.3953, 2.4177, 2.3767, 2.3846, 2.4444,
        2.4398, 2.4744, 2.4624, 2.4368, 2.4276, 2.4041, 2.5227, 2.3928, 2.4719,
        2.4711, 2.4062, 2.3646, 2.4500, 2.4615, 2.4040, 2.3611, 2.4143, 2.4764,
        2.3696, 2.4125, 2.3010, 2.4569, 2.3164, 2.3231, 2.5019, 2.4774, 2.4905,
        2.4870, 2.4023, 2.4649, 2.4565, 2.5110, 2.4146, 2.5766, 2.3678, 2.6059,
        2.4714, 2.3895, 2.5057, 2.4381, 2.5117, 2.5294, 2.3840, 2.5040, 2.3911,
        2.5376, 2.3528, 2.4210, 2.4723, 2.5014, 2.4644, 2.4250, 2.3370, 2.5195,
        2.3609, 2.3868, 2.4166, 2.5133, 2.4766, 2.5414, 2.0707, 2.1432, 2.2704,
        2.1722, 2.1286, 2.3176, 2.1441, 2.2130, 2.1762, 2.0720, 2.2396, 2.1160,
        2.2288, 2.1334, 2.1365, 2.0588, 2.2837, 2.1830, 2.1672, 2.0988, 2.1709,
        2.2502, 2.1961, 2.1128, 2.1151, 2.1517, 2.1607, 2.1451, 2.1521, 2.2840,
        2.1516, 2.2946, 2.4342, 2.4400, 2.5017, 2.5645, 2.4888, 2.5237, 2.4832,
        2.5662, 2.4479, 2.4722, 2.5537, 2.3988, 2.5687, 2.5034, 2.5631, 2.3648,
        2.5815, 2.4315, 2.3811, 2.4004, 2.4484, 2.5016, 2.4740, 2.5186, 2.3146,
        2.4274, 2.4597, 2.5138, 2.4425, 2.4618, 2.4476, 2.5620, 2.5699, 2.5734,
        2.6760, 2.6457, 2.5365, 2.7377, 2.6249, 2.7032, 2.6283, 2.5057, 2.6991,
        2.5756, 2.7015, 2.6388, 2.6156, 2.6082, 2.6439, 2.5464, 2.5660, 2.5437,
        2.4646, 2.7216, 2.5982, 2.5878, 2.4356, 2.5987, 2.6579, 2.6060, 2.5652,
        2.6998, 2.6220, 2.7577, 2.6606, 2.6878, 2.7734, 2.7729, 2.7226, 2.9116,
        2.6736, 2.8489, 2.7621, 2.6848, 2.8663, 2.7069, 2.8002, 2.8801, 2.7000,
        2.7518, 2.7372, 2.7322, 2.7148, 2.7020, 2.7318, 2.8096, 2.7234, 2.7399,
        2.5758, 2.7286, 2.6337, 2.7528, 2.7284, 2.7779, 2.7632, 2.9005],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([5.5546, 5.7857, 5.5052, 4.9002, 5.0509, 5.5223, 5.1587, 5.8521, 5.7731,
        4.8198, 5.3266, 5.4348, 6.5510, 5.5244, 5.1165, 5.1270, 5.0799, 5.4675,
        5.0120, 5.8985, 5.6365, 5.2402, 5.6304, 6.1380, 5.4739, 5.2166, 4.3178,
        5.6618, 5.9432, 5.6221, 5.3244, 6.4319, 6.5380, 7.0451, 6.4111, 6.6940,
        6.3624, 7.4150, 7.3340, 7.3545, 6.9760, 6.3705, 6.6459, 7.2178, 7.5027,
        7.0376, 7.0668, 6.3928, 6.5595, 7.1367, 6.0590, 7.2863, 6.8045, 6.8051,
        6.6220, 7.0601, 7.8861, 7.1189, 7.6740, 6.3951, 7.7533, 6.3909, 7.0483,
        7.7339, 7.0622, 7.4397, 7.5881, 7.1715, 6.8460, 8.0539, 7.2278, 8.1861,
        7.6864, 7.2437, 7.3976, 7.6636, 8.1241, 8.0449, 7.5188, 7.3460, 7.0757,
        7.4097, 7.3981, 7.6253, 8.0770, 7.3894, 7.1588, 7.8372, 7.6319, 7.1366,
        7.3526, 7.7736, 8.1479, 7.3578, 8.1608, 8.1746, 7.5035, 7.0802, 7.5535,
        7.4824, 7.3424, 8.3663, 7.1826, 8.2309, 7.8887, 7.1581, 7.6427, 7.5435,
        8.6752, 8.3255, 7.9527, 7.5027, 6.2517, 8.1233, 7.8311, 7.6503, 7.8206,
        6.7343, 7.0674, 7.6405, 8.1715, 7.4070, 6.5306, 7.6463, 8.0343, 7.6443,
        7.4566, 8.3438, 5.3875, 5.9067, 5.2807, 5.3371, 5.2736, 5.6694, 5.1452,
        5.8276, 5.2028, 4.9492, 5.6347, 5.0512, 6.7317, 5.6195, 5.6499, 5.4024,
        5.5980, 5.3296, 5.6680, 5.5220, 5.7136, 5.4900, 5.0983, 5.4770, 5.1291,
        5.4677, 4.7944, 5.2692, 6.3071, 6.1446, 5.6368, 5.5075, 6.9961, 7.4937,
        7.1392, 6.3700, 6.8987, 7.8844, 7.0537, 7.5068, 7.2292, 6.1459, 7.0879,
        6.5430, 7.6554, 7.4880, 6.8755, 6.7027, 7.0600, 6.9778, 6.9003, 7.8775,
        7.1035, 6.6487, 6.8355, 6.5155, 6.6370, 7.5136, 7.1297, 7.0227, 7.0087,
        6.7579, 6.9336, 6.7733, 7.0584, 7.9790, 7.2091, 7.6032, 7.1918, 8.1170,
        7.6859, 7.8657, 7.5363, 7.2213, 7.7926, 7.5551, 8.2442, 7.5270, 7.4388,
        7.2512, 8.3130, 7.7543, 7.1894, 7.8002, 7.0834, 7.7564, 7.3454, 6.7791,
        7.2031, 7.2331, 8.0738, 7.3713, 7.3210, 7.5902, 7.4672, 7.6638, 6.7726,
        7.4988, 7.0257, 7.5574, 7.0152, 8.3050, 6.5831, 7.6140, 7.1461, 7.1314,
        7.2901, 6.8311, 8.0629, 7.7429, 7.9681, 6.9637, 7.3557, 7.4346, 7.3877,
        7.1762, 6.7465, 6.5636, 7.7806, 7.1574, 7.2172, 7.2293, 6.0964, 7.5216,
        7.6299, 7.6202, 7.3439, 8.2940, 4.0040, 4.3538, 4.0661, 3.7808, 4.8422,
        4.2959, 4.2908, 4.4433, 4.2964, 3.9586, 4.1003, 3.7421, 4.5729, 4.0999,
        3.7835, 3.9006, 4.1601, 4.2775, 4.4188, 4.0742, 3.7839, 4.2012, 3.8195,
        4.2712, 3.7325, 4.0657, 3.5436, 3.9245, 4.1161, 4.7646, 4.0835, 4.6639,
        5.0875, 5.4599, 5.1118, 5.5653, 5.4457, 5.7327, 5.7222, 5.5296, 5.4107,
        5.6033, 5.8393, 4.7894, 5.5815, 5.1113, 5.2232, 5.1043, 5.6310, 5.1594,
        5.4533, 5.3471, 5.3396, 5.6910, 5.5698, 5.3242, 4.7493, 5.2055, 4.8453,
        4.6920, 5.6089, 5.4520, 4.9496, 5.7377, 5.8455, 5.6487, 5.6864, 5.9750,
        5.9525, 6.1224, 6.0632, 5.9381, 5.8930, 5.7798, 6.3642, 5.7254, 6.1105,
        6.1065, 5.7899, 5.5912, 6.0024, 6.0590, 5.7792, 5.5748, 5.8287, 6.1328,
        5.6152, 5.8204, 5.2948, 6.0365, 5.3656, 5.3970, 6.2596, 6.1373, 6.2024,
        6.1851, 5.7711, 6.0757, 6.0342, 6.3051, 5.8301, 6.6390, 5.6066, 6.7908,
        6.1079, 5.7097, 6.2786, 5.9441, 6.3085, 6.3979, 5.6836, 6.2701, 5.7176,
        6.4397, 5.5359, 5.8611, 6.1122, 6.2571, 6.0734, 5.8807, 5.4615, 6.3477,
        5.5739, 5.6968, 5.8398, 6.3165, 6.1335, 6.4586, 4.2876, 4.5931, 5.1547,
        4.7184, 4.5308, 5.3713, 4.5972, 4.8975, 4.7361, 4.2931, 5.0158, 4.4776,
        4.9677, 4.5514, 4.5645, 4.2388, 5.2152, 4.7654, 4.6968, 4.4048, 4.7128,
        5.0634, 4.8230, 4.4640, 4.4738, 4.6299, 4.6684, 4.6014, 4.6316, 5.2165,
        4.6296, 5.2653, 5.9255, 5.9534, 6.2585, 6.5767, 6.1942, 6.3692, 6.1665,
        6.5855, 5.9923, 6.1119, 6.5215, 5.7543, 6.5982, 6.2670, 6.5695, 5.5921,
        6.6643, 5.9123, 5.6697, 5.7619, 5.9946, 6.2581, 6.1206, 6.3435, 5.3574,
        5.8921, 6.0502, 6.3190, 5.9660, 6.0606, 5.9908, 6.5641, 6.6041, 6.6221,
        7.1610, 6.9997, 6.4340, 7.4951, 6.8900, 7.3071, 6.9081, 6.2788, 7.2852,
        6.6338, 7.2983, 6.9635, 6.8415, 6.8027, 6.9902, 6.4842, 6.5842, 6.4704,
        6.0745, 7.4072, 6.7509, 6.6969, 5.9320, 6.7535, 7.0644, 6.7913, 6.5803,
        7.2887, 6.8749, 7.6049, 7.0788, 7.2245, 7.6917, 7.6889, 7.4127, 8.4774,
        7.1481, 8.1161, 7.6290, 7.2083, 8.2159, 7.3274, 7.8414, 8.2952, 7.2898,
        7.5723, 7.4923, 7.4651, 7.3702, 7.3007, 7.4628, 7.8937, 7.4171, 7.5069,
        6.6348, 7.4454, 6.9366, 7.5781, 7.4442, 7.7167, 7.6353, 8.4131],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 3253.8291015625
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([3.8464, 3.6148, 3.6211, 3.7430, 3.7898, 3.6717, 3.8063, 3.6457, 3.6614,
        3.7618, 3.7249, 3.7060, 3.5761, 3.7302, 3.6145, 3.6996, 3.8170, 3.7274,
        3.7322, 3.6725, 3.5577, 3.8232, 3.5667, 3.4823, 3.6281, 3.7193, 3.9071,
        3.6206, 3.6401, 3.7592, 3.6181, 3.5632, 3.0029, 2.8659, 2.9404, 2.8986,
        2.9681, 2.8295, 2.8637, 2.8857, 2.9201, 2.9825, 2.9834, 2.9180, 2.8028,
        2.9367, 2.8334, 2.8774, 3.0705, 2.9560, 2.8971, 2.8549, 2.8920, 2.9480,
        2.9006, 2.8253, 2.7590, 2.9220, 2.7537, 2.9592, 2.8181, 3.0288, 2.8592,
        2.6869, 2.9355, 2.8315, 2.7941, 2.7643, 2.8656, 2.8112, 2.9110, 2.7694,
        2.8394, 2.8740, 2.7991, 2.8580, 2.7604, 2.8308, 2.8548, 2.8842, 2.8391,
        2.8349, 2.8177, 2.8474, 2.7311, 2.9553, 2.8009, 2.7137, 2.7769, 2.9535,
        2.7352, 2.7686, 2.7014, 2.7718, 2.6554, 2.8342, 2.9744, 2.9809, 2.9065,
        2.9198, 3.0053, 2.8789, 3.0024, 2.8798, 2.8406, 3.0446, 2.8869, 2.9362,
        2.8031, 2.9182, 2.8024, 2.9780, 3.0565, 2.8147, 2.8558, 2.9622, 2.8123,
        3.0207, 2.9462, 2.8680, 2.8636, 2.9965, 3.0609, 2.8061, 2.8197, 2.8988,
        2.8160, 2.9235, 3.4419, 3.1503, 3.2776, 3.1948, 3.4903, 3.2520, 3.3852,
        3.1637, 3.2258, 3.3842, 3.2846, 3.3949, 3.1998, 3.2984, 3.2793, 3.2670,
        3.2369, 3.3151, 3.3188, 3.3445, 3.2559, 3.3488, 3.1744, 3.2834, 3.3608,
        3.3445, 3.3268, 3.2554, 3.2489, 3.3250, 3.2442, 3.3153, 2.7737, 2.5660,
        2.6628, 2.7136, 2.6102, 2.5352, 2.5926, 2.5637, 2.5959, 2.7454, 2.5971,
        2.6979, 2.5344, 2.5968, 2.6107, 2.6718, 2.5198, 2.6098, 2.5971, 2.5232,
        2.6313, 2.6461, 2.6549, 2.6230, 2.6027, 2.6747, 2.5477, 2.5676, 2.5238,
        2.5810, 2.6255, 2.7145, 2.7829, 2.6448, 2.6065, 2.5803, 2.6526, 2.5954,
        2.6019, 2.5854, 2.6245, 2.6845, 2.6244, 2.6684, 2.5389, 2.6409, 2.6782,
        2.5785, 2.4700, 2.5526, 2.5836, 2.6201, 2.6620, 2.5894, 2.6414, 2.5508,
        2.7095, 2.7023, 2.4658, 2.6105, 2.6815, 2.5655, 2.5294, 2.5987, 2.8756,
        2.7088, 2.8150, 2.6866, 2.7338, 2.6455, 2.8830, 2.6876, 2.7969, 2.8415,
        2.7744, 2.7392, 2.7168, 2.7027, 2.5980, 2.7956, 2.7734, 2.6709, 2.7711,
        2.7829, 2.7948, 2.7995, 2.5347, 2.6428, 2.8052, 2.7243, 2.8400, 2.6646,
        2.7431, 2.7845, 2.6398, 2.7159, 4.0463, 3.9208, 3.8974, 3.9030, 3.8571,
        3.8338, 3.9548, 3.7377, 3.7120, 3.8814, 3.8815, 3.9791, 3.8757, 3.9014,
        3.8611, 3.9662, 3.7202, 3.8805, 3.8112, 3.9027, 3.6866, 3.8909, 3.9240,
        3.7253, 3.8339, 3.9497, 3.8497, 3.8175, 3.9001, 3.9312, 3.9838, 3.8779,
        2.9707, 2.9866, 2.9980, 2.9976, 2.8896, 2.8401, 2.8918, 2.9899, 2.9961,
        2.8796, 2.8543, 2.9724, 2.9119, 2.9310, 2.9052, 3.0098, 2.8092, 3.0279,
        2.8982, 2.8923, 2.9324, 2.9587, 2.9611, 2.8576, 3.0075, 2.9617, 2.9031,
        2.9521, 2.9322, 3.0419, 2.9514, 2.9117, 3.2659, 3.1064, 3.1276, 3.1461,
        3.2150, 3.0668, 3.1899, 3.1920, 3.2127, 3.0923, 3.0727, 3.1184, 3.1242,
        3.1330, 3.0423, 3.1904, 3.1375, 2.9532, 2.9944, 3.0939, 3.0841, 3.0442,
        3.2364, 3.1553, 3.2397, 3.0741, 2.9649, 3.2158, 2.9978, 3.1692, 2.9180,
        3.0899, 3.2646, 3.2383, 3.2700, 3.1028, 3.2967, 3.1349, 3.4441, 3.1895,
        3.1303, 3.3531, 3.2393, 3.2311, 3.2479, 3.1907, 3.2586, 3.2559, 3.0751,
        3.1938, 3.2083, 3.3011, 3.2641, 3.2232, 3.0838, 3.2227, 3.3106, 3.1978,
        3.2240, 3.2295, 3.2637, 3.2958, 3.1748, 3.2551, 3.4304, 3.3143, 3.2232,
        3.2922, 3.5035, 3.2624, 3.3719, 3.3223, 3.2862, 3.3396, 3.2425, 3.3931,
        3.3581, 3.3894, 3.3091, 3.3954, 3.2049, 3.3564, 3.2304, 3.4645, 3.1861,
        3.3516, 3.2976, 3.3426, 3.4396, 3.4429, 3.2921, 3.3335, 3.2972, 3.2899,
        3.2240, 3.2553, 2.6947, 2.7621, 2.6840, 2.7685, 2.8744, 2.6624, 2.7288,
        2.6813, 2.7053, 2.6895, 2.5623, 2.8266, 2.5585, 2.7625, 2.6883, 2.7319,
        2.5750, 2.7332, 2.7711, 2.8854, 2.6594, 2.7428, 2.5948, 2.7372, 3.0455,
        2.7226, 2.5716, 2.7686, 2.7889, 2.7523, 2.7076, 2.6079, 2.8667, 2.7936,
        2.6430, 2.7562, 2.8121, 2.6788, 2.8462, 2.7547, 2.7746, 2.7970, 2.6715,
        2.7489, 2.6631, 2.7883, 2.6531, 2.8079, 2.6325, 2.6788, 2.7937, 2.7527,
        2.8291, 2.6773, 2.7085, 2.7549, 3.0533, 2.7552, 2.5309, 2.7961, 2.8065,
        2.7642, 2.7237, 2.6573, 3.0153, 2.8937, 2.8569, 2.7513, 2.9863, 2.8401,
        2.9421, 2.8624, 2.8518, 2.9354, 2.8160, 2.8905, 2.8366, 2.7582, 2.9119,
        2.9299, 2.7028, 2.9099, 2.8865, 2.9176, 2.8259, 2.8752, 2.8544, 2.9135,
        3.1200, 2.8808, 3.0062, 2.8388, 2.8175, 2.9153, 2.8425, 2.7853],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([14.7949, 13.0670, 13.1122, 14.0103, 14.3628, 13.4813, 14.4882, 13.2910,
        13.4060, 14.1512, 13.8746, 13.7347, 12.7887, 13.9143, 13.0647, 13.6869,
        14.5698, 13.8936, 13.9296, 13.4873, 12.6571, 14.6172, 12.7212, 12.1265,
        13.1633, 13.8329, 15.2654, 13.1084, 13.2502, 14.1317, 13.0908, 12.6967,
         9.0176,  8.2131,  8.6460,  8.4021,  8.8094,  8.0063,  8.2007,  8.3273,
         8.5269,  8.8951,  8.9010,  8.5148,  7.8557,  8.6241,  8.0283,  8.2792,
         9.4279,  8.7381,  8.3930,  8.1506,  8.3635,  8.6904,  8.4134,  7.9824,
         7.6121,  8.5378,  7.5829,  8.7568,  7.9416,  9.1739,  8.1752,  7.2194,
         8.6173,  8.0175,  7.8072,  7.6412,  8.2116,  7.9027,  8.4739,  7.6693,
         8.0622,  8.2597,  7.8348,  8.1682,  7.6201,  8.0136,  8.1501,  8.3188,
         8.0607,  8.0364,  7.9392,  8.1077,  7.4591,  8.7337,  7.8452,  7.3640,
         7.7113,  8.7233,  7.4812,  7.6654,  7.2977,  7.6829,  7.0512,  8.0328,
         8.8471,  8.8860,  8.4475,  8.5250,  9.0319,  8.2882,  9.0142,  8.2930,
         8.0692,  9.2698,  8.3344,  8.6215,  7.8573,  8.5157,  7.8536,  8.8683,
         9.3424,  7.9226,  8.1557,  8.7749,  7.9088,  9.1247,  8.6799,  8.2255,
         8.1999,  8.9791,  9.3689,  7.8740,  7.9508,  8.4031,  7.9297,  8.5467,
        11.8469,  9.9246, 10.7429, 10.2070, 12.1823, 10.5755, 11.4593, 10.0088,
        10.4057, 11.4529, 10.7887, 11.5252, 10.2385, 10.8793, 10.7539, 10.6734,
        10.4774, 10.9899, 11.0144, 11.1855, 10.6008, 11.2142, 10.0771, 10.7807,
        11.2949, 11.1855, 11.0679, 10.5976, 10.5556, 11.0559, 10.5249, 10.9911,
         7.6935,  6.5844,  7.0906,  7.3639,  6.8131,  6.4275,  6.7215,  6.5724,
         6.7387,  7.5370,  6.7449,  7.2788,  6.4230,  6.7432,  6.8156,  7.1387,
         6.3496,  6.8110,  6.7448,  6.3667,  6.9236,  7.0018,  7.0483,  6.8799,
         6.7738,  7.1539,  6.4906,  6.5924,  6.3695,  6.6613,  6.8931,  7.3685,
         7.7447,  6.9951,  6.7941,  6.6579,  7.0361,  6.7360,  6.7697,  6.6845,
         6.8881,  7.2067,  6.8873,  7.1202,  6.4461,  6.9743,  7.1729,  6.6484,
         6.1010,  6.5156,  6.6749,  6.8651,  7.0863,  6.7052,  6.9770,  6.5066,
         7.3414,  7.3026,  6.0801,  6.8145,  7.1902,  6.5818,  6.3981,  6.7532,
         8.2691,  7.3379,  7.9242,  7.2180,  7.4734,  6.9988,  8.3119,  7.2233,
         7.8225,  8.0740,  7.6975,  7.5034,  7.3809,  7.3048,  6.7496,  7.8156,
         7.6918,  7.1337,  7.6791,  7.7443,  7.8108,  7.8371,  6.4246,  6.9842,
         7.8694,  7.4220,  8.0654,  7.0999,  7.5248,  7.7533,  6.9685,  7.3761,
        16.3722, 15.3729, 15.1896, 15.2332, 14.8772, 14.6979, 15.6402, 13.9705,
        13.7788, 15.0655, 15.0662, 15.8336, 15.0209, 15.2208, 14.9078, 15.7305,
        13.8402, 15.0581, 14.5255, 15.2311, 13.5912, 15.1388, 15.3981, 13.8777,
        14.6989, 15.5998, 14.8205, 14.5733, 15.2109, 15.4540, 15.8709, 15.0378,
         8.8253,  8.9198,  8.9883,  8.9854,  8.3497,  8.0664,  8.3626,  8.9396,
         8.9766,  8.2920,  8.1467,  8.8352,  8.4792,  8.5907,  8.4402,  9.0591,
         7.8916,  9.1680,  8.3995,  8.3654,  8.5992,  8.7541,  8.7680,  8.1656,
         9.0450,  8.7714,  8.4282,  8.7149,  8.5978,  9.2531,  8.7105,  8.4778,
        10.6660,  9.6496,  9.7820,  9.8977, 10.3364,  9.4054, 10.1753, 10.1889,
        10.3212,  9.5624,  9.4413,  9.7244,  9.7605,  9.8156,  9.2555, 10.1789,
         9.8441,  8.7216,  8.9666,  9.5720,  9.5119,  9.2669, 10.4740,  9.9557,
        10.4957,  9.4501,  8.7904, 10.3412,  8.9871, 10.0436,  8.5148,  9.5477,
        10.6577, 10.4863, 10.6932,  9.6272, 10.8685,  9.8277, 11.8621, 10.1728,
         9.7989, 11.2434, 10.4933, 10.4397, 10.5485, 10.1806, 10.6185, 10.6011,
         9.4563, 10.2004, 10.2933, 10.8971, 10.6541, 10.3887,  9.5098, 10.3861,
        10.9602, 10.2262, 10.3944, 10.4297, 10.6517, 10.8624, 10.0795, 10.5958,
        11.7677, 10.9848, 10.3892, 10.8384, 12.2743, 10.6430, 11.3695, 11.0378,
        10.7988, 11.1529, 10.5137, 11.5134, 11.2771, 11.4883, 10.9503, 11.5285,
        10.2713, 11.2652, 10.4357, 12.0030, 10.1509, 11.2331, 10.8742, 11.1728,
        11.8307, 11.8534, 10.8379, 11.1120, 10.8714, 10.8234, 10.3939, 10.5967,
         7.2614,  7.6292,  7.2036,  7.6648,  8.2620,  7.0884,  7.4462,  7.1892,
         7.3187,  7.2333,  6.5653,  7.9897,  6.5462,  7.6316,  7.2269,  7.4631,
         6.6308,  7.4705,  7.6790,  8.3256,  7.0724,  7.5229,  6.7329,  7.4922,
         9.2754,  7.4126,  6.6131,  7.6651,  7.7780,  7.5749,  7.3311,  6.8013,
         8.2183,  7.8043,  6.9855,  7.5964,  7.9080,  7.1758,  8.1006,  7.5883,
         7.6985,  7.8231,  7.1370,  7.5564,  7.0919,  7.7745,  7.0388,  7.8841,
         6.9303,  7.1761,  7.8050,  7.5775,  8.0038,  7.1681,  7.3357,  7.5897,
         9.3228,  7.5913,  6.4054,  7.8184,  7.8763,  7.6409,  7.4186,  7.0613,
         9.0919,  8.3737,  8.1618,  7.5694,  8.9177,  8.0664,  8.6557,  8.1934,
         8.1325,  8.6166,  7.9297,  8.3553,  8.0465,  7.6078,  8.4793,  8.5845,
         7.3054,  8.4674,  8.3318,  8.5125,  7.9859,  8.2666,  8.1477,  8.4883,
         9.7341,  8.2993,  9.0371,  8.0586,  7.9385,  8.4990,  8.0798,  7.7579],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 4755.953125
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([2.2629, 2.2056, 2.2907, 2.1429, 2.2456, 2.1736, 2.2468, 2.1002, 2.2020,
        2.1979, 2.1267, 2.2173, 2.1207, 2.2034, 2.2398, 2.1401, 2.2225, 2.1695,
        2.1479, 2.1934, 2.1307, 2.2361, 2.2108, 2.2214, 2.2088, 2.2759, 2.2306,
        2.1506, 2.1843, 2.2258, 2.2592, 2.2015, 2.0785, 1.9224, 2.0071, 2.0161,
        2.0213, 1.9719, 1.9607, 1.9215, 2.0303, 2.0434, 1.9901, 1.8787, 1.9168,
        1.9635, 1.9630, 2.0081, 2.1468, 2.0329, 2.0180, 1.9249, 1.9261, 2.0805,
        1.9939, 1.9028, 1.9481, 1.9680, 1.8614, 2.0023, 1.9430, 2.0113, 1.9270,
        1.9773, 2.3179, 2.2694, 2.2184, 2.2239, 2.3040, 2.1657, 2.2046, 2.1682,
        2.2591, 2.3437, 2.2865, 2.2301, 2.1932, 2.1161, 2.1381, 2.2487, 2.2905,
        2.2272, 2.2220, 2.2013, 2.1877, 2.5272, 2.2477, 2.1864, 2.1406, 2.1924,
        2.3362, 2.1957, 2.2330, 2.2105, 2.1656, 2.1458, 2.4587, 2.4183, 2.4594,
        2.4349, 2.4461, 2.4018, 2.5227, 2.3319, 2.3801, 2.5096, 2.3886, 2.4968,
        2.3309, 2.4043, 2.4111, 2.5061, 2.5854, 2.3728, 2.3733, 2.4905, 2.4106,
        2.5579, 2.4463, 2.4078, 2.3699, 2.3810, 2.6363, 2.3159, 2.4668, 2.4337,
        2.5002, 2.3684, 2.0785, 2.0600, 2.1248, 2.1755, 2.0230, 2.1379, 2.1085,
        2.0298, 2.0919, 2.0344, 2.0999, 2.0967, 1.9893, 2.2149, 2.0832, 2.1491,
        1.8874, 2.0509, 2.0310, 2.0656, 2.1218, 2.0432, 2.1209, 2.1208, 2.1242,
        2.1518, 2.0213, 2.0537, 2.0377, 2.1923, 2.0397, 2.0359, 1.7597, 1.6942,
        1.7692, 1.7694, 1.7235, 1.6884, 1.7649, 1.7015, 1.7771, 1.8276, 1.7268,
        1.8262, 1.6598, 1.7399, 1.7552, 1.8042, 1.6939, 1.7711, 1.8119, 1.7315,
        1.7430, 1.7711, 1.7911, 1.8455, 1.7942, 1.7080, 1.6859, 1.7103, 1.7707,
        1.7272, 1.7315, 2.0005, 2.0989, 1.9498, 2.0614, 1.9867, 2.0315, 1.9265,
        1.9696, 1.9455, 1.9134, 1.9706, 1.9452, 2.0110, 1.9226, 1.9505, 1.9796,
        2.0303, 1.8120, 1.8953, 2.0388, 1.9245, 1.9191, 2.0388, 1.9716, 2.0872,
        2.0311, 1.9553, 1.9070, 1.9918, 1.9746, 2.0713, 2.0076, 1.9826, 2.2283,
        2.1939, 2.1838, 2.1623, 2.1897, 2.1802, 2.2240, 2.1257, 2.1623, 2.2047,
        2.1640, 2.2043, 2.1194, 2.1257, 2.1702, 2.2732, 2.1300, 2.1714, 2.2037,
        2.2146, 2.1758, 2.2766, 2.1189, 2.1398, 2.2249, 2.1938, 2.3483, 2.1878,
        2.1107, 2.2133, 2.1695, 2.2402, 2.8698, 2.7514, 2.9278, 2.7631, 2.7565,
        2.9389, 2.8984, 2.8771, 2.8607, 2.8883, 2.8995, 2.8903, 2.8502, 2.8919,
        2.8109, 2.8030, 2.7599, 2.7503, 2.7301, 2.7943, 2.8621, 2.7857, 2.8254,
        2.7570, 2.8470, 2.8154, 2.7602, 2.8745, 2.8098, 2.8435, 2.7702, 2.9487,
        2.6981, 2.7590, 2.7532, 2.6769, 2.7282, 2.7593, 2.6905, 2.7118, 2.6820,
        2.7947, 2.7664, 2.7584, 2.7539, 2.8114, 2.7017, 2.7529, 2.6805, 2.7268,
        2.6235, 2.7790, 2.6661, 2.7335, 2.6312, 2.6710, 2.7435, 2.7414, 2.7451,
        2.7463, 2.6954, 2.7402, 2.6986, 2.7324, 2.6189, 2.5304, 2.5884, 2.5236,
        2.5450, 2.5191, 2.5073, 2.5077, 2.5652, 2.5455, 2.5528, 2.5693, 2.4972,
        2.6397, 2.5484, 2.5799, 2.4982, 2.6156, 2.5736, 2.5792, 2.6221, 2.5295,
        2.5511, 2.5811, 2.5873, 2.5258, 2.5930, 2.5573, 2.5679, 2.5556, 2.5114,
        2.6010, 2.9541, 2.8707, 2.8629, 2.9770, 2.8697, 3.0013, 2.9204, 2.9548,
        2.9719, 2.9334, 2.8765, 2.9586, 2.9198, 2.8637, 2.8329, 2.9666, 2.8180,
        2.9051, 2.9371, 2.9408, 2.9059, 2.8564, 2.7878, 2.8646, 2.9367, 2.9554,
        2.9539, 2.9534, 2.8758, 2.8574, 2.8992, 2.8529, 2.2530, 2.2746, 2.2035,
        2.1403, 2.1292, 2.2404, 2.1863, 2.1626, 2.2365, 2.1536, 2.2239, 2.1834,
        2.1709, 2.1677, 2.1980, 2.2014, 2.0595, 2.1445, 2.2741, 2.1237, 2.1814,
        2.1184, 2.1287, 2.1741, 2.1109, 2.1772, 2.1628, 2.1659, 2.1547, 2.2319,
        2.1752, 2.2621, 2.0192, 1.9726, 2.0270, 2.0501, 2.0010, 1.9352, 2.0610,
        2.0232, 1.9617, 2.0404, 1.9511, 2.0757, 1.9993, 2.0380, 2.0330, 2.0455,
        2.0120, 1.9321, 2.0154, 2.1252, 2.0133, 1.9718, 2.0136, 2.0371, 2.1315,
        2.0087, 2.0056, 1.9561, 2.0107, 1.9718, 2.0587, 1.9562, 2.2238, 2.1022,
        1.9993, 2.1310, 2.1100, 1.9272, 2.0235, 1.9947, 1.9495, 2.1277, 1.9679,
        2.1082, 1.9492, 2.0630, 2.1396, 2.0021, 2.1131, 2.0631, 1.9791, 2.1560,
        2.0956, 1.9922, 2.0186, 2.0928, 2.3738, 2.1062, 2.0112, 2.0240, 2.0477,
        1.9972, 1.9515, 1.8950, 2.4192, 2.3794, 2.3133, 2.3814, 2.3442, 2.2668,
        2.3660, 2.3905, 2.2587, 2.4091, 2.3484, 2.3959, 2.2950, 2.2744, 2.2807,
        2.3822, 2.3337, 2.3269, 2.3708, 2.4077, 2.3094, 2.3956, 2.3620, 2.3186,
        2.4780, 2.3558, 2.4883, 2.3402, 2.3652, 2.3658, 2.4982, 2.3098],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([5.1208, 4.8648, 5.2475, 4.5918, 5.0425, 4.7246, 5.0481, 4.4109, 4.8486,
        4.8307, 4.5230, 4.9164, 4.4972, 4.8550, 5.0166, 4.5799, 4.9394, 4.7067,
        4.6134, 4.8108, 4.5397, 5.0000, 4.8875, 4.9347, 4.8789, 5.1798, 4.9754,
        4.6249, 4.7712, 4.9540, 5.1041, 4.8464, 4.3202, 3.6956, 4.0283, 4.0648,
        4.0856, 3.8885, 3.8445, 3.6923, 4.1222, 4.1755, 3.9606, 3.5293, 3.6743,
        3.8554, 3.8535, 4.0324, 4.6090, 4.1327, 4.0721, 3.7054, 3.7099, 4.3283,
        3.9757, 3.6208, 3.7951, 3.8729, 3.4647, 4.0090, 3.7751, 4.0454, 3.7135,
        3.9097, 5.3727, 5.1503, 4.9212, 4.9455, 5.3085, 4.6903, 4.8603, 4.7013,
        5.1036, 5.4931, 5.2282, 4.9733, 4.8100, 4.4781, 4.5715, 5.0565, 5.2466,
        4.9602, 4.9374, 4.8457, 4.7859, 6.3868, 5.0523, 4.7802, 4.5822, 4.8065,
        5.4579, 4.8211, 4.9864, 4.8863, 4.6899, 4.6042, 6.0451, 5.8483, 6.0487,
        5.9289, 5.9832, 5.7686, 6.3639, 5.4376, 5.6647, 6.2981, 5.7052, 6.2342,
        5.4332, 5.7805, 5.8136, 6.2806, 6.6841, 5.6302, 5.6323, 6.2025, 5.8109,
        6.5430, 5.9843, 5.7973, 5.6163, 5.6691, 6.9500, 5.3634, 6.0852, 5.9229,
        6.2511, 5.6092, 4.3200, 4.2438, 4.5148, 4.7330, 4.0925, 4.5706, 4.4460,
        4.1202, 4.3760, 4.1389, 4.4096, 4.3960, 3.9574, 4.9058, 4.3398, 4.6187,
        3.5624, 4.2063, 4.1251, 4.2666, 4.5021, 4.1746, 4.4982, 4.4978, 4.5123,
        4.6304, 4.0857, 4.2179, 4.1521, 4.8061, 4.1605, 4.1449, 3.0966, 2.8703,
        3.1299, 3.1308, 2.9704, 2.8507, 3.1150, 2.8952, 3.1581, 3.3403, 2.9820,
        3.3349, 2.7548, 3.0271, 3.0807, 3.2550, 2.8694, 3.1368, 3.2831, 2.9981,
        3.0380, 3.1368, 3.2081, 3.4058, 3.2192, 2.9173, 2.8423, 2.9252, 3.1354,
        2.9833, 2.9983, 4.0021, 4.4056, 3.8016, 4.2492, 3.9470, 4.1268, 3.7115,
        3.8795, 3.7848, 3.6609, 3.8832, 3.7840, 4.0441, 3.6964, 3.8043, 3.9187,
        4.1223, 3.2835, 3.5922, 4.1567, 3.7036, 3.6831, 4.1569, 3.8873, 4.3562,
        4.1252, 3.8232, 3.6368, 3.9673, 3.8992, 4.2903, 4.0304, 3.9308, 4.9654,
        4.8133, 4.7689, 4.6754, 4.7947, 4.7533, 4.9464, 4.5184, 4.6756, 4.8607,
        4.6827, 4.8589, 4.4919, 4.5186, 4.7096, 5.1673, 4.5367, 4.7151, 4.8564,
        4.9044, 4.7343, 5.1829, 4.4897, 4.5789, 4.9501, 4.8128, 5.5143, 4.7865,
        4.4552, 4.8989, 4.7067, 5.0184, 8.2356, 7.5703, 8.5719, 7.6349, 7.5982,
        8.6369, 8.4007, 8.2779, 8.1837, 8.3420, 8.4071, 8.3539, 8.1238, 8.3629,
        7.9011, 7.8571, 7.6172, 7.5644, 7.4533, 7.8081, 8.1916, 7.7600, 7.9827,
        7.6010, 8.1057, 7.9264, 7.6188, 8.2625, 7.8951, 8.0853, 7.6739, 8.6951,
        7.2796, 7.6120, 7.5801, 7.1656, 7.4431, 7.6135, 7.2390, 7.3536, 7.1929,
        7.8106, 7.6532, 7.6088, 7.5840, 7.9038, 7.2991, 7.5785, 7.1852, 7.4353,
        6.8827, 7.7226, 7.1081, 7.4721, 6.9232, 7.1342, 7.5267, 7.5151, 7.5354,
        7.5422, 7.2651, 7.5086, 7.2825, 7.4658, 6.8588, 6.4027, 6.6997, 6.3685,
        6.4770, 6.3456, 6.2866, 6.2888, 6.5801, 6.4797, 6.5168, 6.6012, 6.2361,
        6.9682, 6.4943, 6.6557, 6.2410, 6.8414, 6.6236, 6.6521, 6.8755, 6.3982,
        6.5080, 6.6618, 6.6941, 6.3797, 6.7237, 6.5398, 6.5939, 6.5312, 6.3069,
        6.7652, 8.7268, 8.2412, 8.1961, 8.8625, 8.2351, 9.0079, 8.5286, 8.7310,
        8.8322, 8.6049, 8.2741, 8.7536, 8.5254, 8.2005, 8.0255, 8.8005, 7.9412,
        8.4398, 8.6263, 8.6486, 8.4443, 8.1592, 7.7719, 8.2060, 8.6240, 8.7343,
        8.7257, 8.7225, 8.2703, 8.1646, 8.4053, 8.1390, 5.0760, 5.1740, 4.8554,
        4.5809, 4.5336, 5.0196, 4.7798, 4.6767, 5.0018, 4.6378, 4.9458, 4.7671,
        4.7127, 4.6990, 4.8312, 4.8462, 4.2414, 4.5990, 5.1714, 4.5101, 4.7585,
        4.4875, 4.5316, 4.7266, 4.4560, 4.7402, 4.6778, 4.6911, 4.6426, 4.9814,
        4.7317, 5.1173, 4.0771, 3.8913, 4.1087, 4.2029, 4.0040, 3.7448, 4.2476,
        4.0932, 3.8481, 4.1633, 3.8069, 4.3086, 3.9972, 4.1534, 4.1329, 4.1841,
        4.0480, 3.7330, 4.0617, 4.5166, 4.0533, 3.8880, 4.0546, 4.1499, 4.5432,
        4.0349, 4.0223, 3.8262, 4.0428, 3.8882, 4.2381, 3.8266, 4.9452, 4.4193,
        3.9971, 4.5411, 4.4521, 3.7140, 4.0945, 3.9787, 3.8005, 4.5270, 3.8725,
        4.4446, 3.7996, 4.2558, 4.5779, 4.0084, 4.4651, 4.2563, 3.9169, 4.6484,
        4.3916, 3.9690, 4.0747, 4.3800, 5.6351, 4.4362, 4.0448, 4.0966, 4.1929,
        3.9886, 3.8083, 3.5911, 5.8527, 5.6617, 5.3512, 5.6711, 5.4952, 5.1384,
        5.5978, 5.7144, 5.1016, 5.8040, 5.5151, 5.7405, 5.2671, 5.1730, 5.2018,
        5.6747, 5.4461, 5.4145, 5.6207, 5.7969, 5.3333, 5.7390, 5.5789, 5.3757,
        6.1403, 5.5497, 6.1917, 5.4765, 5.5944, 5.5969, 6.2412, 5.3351],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 2716.923828125
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([1.8551, 1.9129, 1.7762, 1.8892, 1.9212, 1.8505, 1.8992, 1.9828, 1.8999,
        1.8485, 1.8278, 1.8635, 1.8750, 1.9885, 1.8618, 1.8711, 2.1976, 1.9425,
        1.9318, 1.8983, 1.8803, 1.9438, 1.8729, 1.9037, 1.9109, 1.8146, 1.9312,
        1.8675, 1.8725, 1.8390, 1.8712, 1.8045, 2.0434, 1.9700, 2.0037, 2.0162,
        2.0136, 1.9711, 2.0236, 2.0339, 2.0306, 1.9848, 2.0349, 1.9720, 1.9503,
        2.0349, 1.9232, 1.9774, 2.1775, 2.0362, 1.9949, 1.9119, 2.0199, 2.0027,
        2.0265, 1.9868, 2.0039, 1.9594, 1.9430, 2.0851, 2.0008, 1.9990, 2.0455,
        1.9062, 2.3979, 2.2556, 2.2904, 2.2219, 2.2723, 2.3460, 2.4920, 2.4385,
        2.2937, 2.2324, 2.3689, 2.3178, 2.2885, 2.2956, 2.3839, 2.3146, 2.2967,
        2.3571, 2.2712, 2.2369, 2.2855, 2.2712, 2.3400, 2.3659, 2.4322, 2.3801,
        2.2498, 2.2229, 2.2777, 2.3482, 2.2534, 2.3362, 2.7339, 2.7161, 2.8363,
        2.7743, 2.7477, 2.7377, 2.6970, 2.9185, 2.8042, 2.6674, 2.8063, 2.7424,
        2.8250, 2.8299, 2.7270, 2.6707, 2.7607, 2.8322, 2.7507, 2.6823, 2.7274,
        2.7163, 2.7111, 2.7726, 2.8399, 2.7024, 2.8539, 2.7794, 2.7185, 2.7246,
        2.5929, 2.7435, 2.2621, 2.3113, 2.1527, 2.2084, 2.3016, 2.1776, 2.2170,
        2.2195, 2.2260, 2.2896, 2.1667, 2.1693, 2.2052, 2.0553, 2.1938, 2.1542,
        2.4122, 2.2518, 2.2571, 2.1869, 2.2224, 2.4445, 2.2909, 2.2214, 2.1750,
        2.1768, 2.1331, 2.1958, 2.2656, 2.2042, 2.1560, 2.4144, 2.2123, 2.1485,
        2.2413, 2.2556, 2.1710, 2.1219, 2.0737, 2.1674, 2.1956, 2.2688, 2.1907,
        2.2563, 2.1173, 2.1052, 2.2059, 2.2689, 2.2423, 2.2447, 2.2554, 2.1010,
        2.1594, 2.2841, 2.2004, 2.1814, 2.1455, 2.1684, 2.1974, 2.1925, 2.1890,
        2.1749, 2.1839, 2.4161, 2.5109, 2.3690, 2.4468, 2.3841, 2.4582, 2.4104,
        2.3049, 2.4544, 2.4240, 2.4362, 2.4914, 2.4418, 2.3626, 2.4486, 2.3677,
        2.3828, 2.4469, 2.4879, 2.3531, 2.3543, 2.4534, 2.4528, 2.4663, 2.2800,
        2.3870, 2.4755, 2.3515, 2.3827, 2.4610, 2.4253, 2.4325, 2.4855, 2.8462,
        2.7663, 2.8109, 2.7745, 2.8422, 2.7059, 2.7877, 2.8144, 2.7811, 2.7683,
        2.8020, 2.7813, 2.7754, 2.8442, 2.7152, 2.7199, 2.9619, 2.7323, 2.7312,
        2.7689, 2.7681, 2.8857, 2.8463, 2.7996, 2.7076, 2.7482, 2.9783, 2.6873,
        2.8270, 2.7572, 2.6853, 2.6212, 2.5290, 2.5606, 2.4466, 2.6086, 2.6058,
        2.3290, 2.4521, 2.5067, 2.4104, 2.5123, 2.4400, 2.4521, 2.3503, 2.4292,
        2.5805, 2.5244, 2.5503, 2.5579, 2.5206, 2.7391, 2.4698, 2.8830, 2.4620,
        2.6304, 2.6209, 2.5591, 2.3826, 2.5054, 2.6022, 2.6585, 2.4210, 2.2766,
        2.2579, 2.1221, 2.2306, 2.1631, 2.1800, 2.0382, 2.0889, 2.1663, 2.1912,
        2.2593, 2.0506, 2.3245, 2.0961, 2.2925, 2.1771, 2.2115, 2.2449, 2.1786,
        2.1273, 2.1705, 2.1548, 2.3530, 2.1228, 2.1146, 2.2537, 2.2598, 2.0805,
        2.1901, 2.1239, 2.1822, 2.2408, 2.1515, 2.6953, 2.5714, 2.6686, 2.5697,
        2.7571, 2.3948, 2.3958, 2.4033, 2.7018, 2.4668, 2.4838, 2.6172, 2.5431,
        2.7040, 2.5529, 2.6335, 2.6374, 2.4119, 2.5204, 2.5383, 2.5386, 2.5104,
        2.5251, 2.5644, 2.5353, 2.5690, 2.4087, 2.5122, 2.4996, 2.6861, 2.6175,
        2.7396, 3.6051, 3.2926, 3.5168, 3.3758, 3.5118, 3.2334, 3.4126, 3.2834,
        3.2665, 3.4264, 3.3975, 3.5445, 3.3083, 3.3525, 3.4632, 3.4633, 3.5184,
        3.3365, 3.2975, 3.5012, 3.3105, 3.5128, 3.4352, 3.3282, 3.1824, 3.2644,
        3.7532, 3.3468, 3.3981, 3.4948, 3.3450, 3.2584, 2.2406, 2.3843, 2.3037,
        2.3466, 2.3959, 2.3216, 2.2988, 2.3501, 2.3206, 2.3949, 2.3308, 2.3119,
        2.3340, 2.4112, 2.3849, 2.3765, 2.4289, 2.2994, 2.2412, 2.4320, 2.3412,
        2.4675, 2.3236, 2.3251, 2.5523, 2.3494, 2.2715, 2.4054, 2.4122, 2.3739,
        2.4160, 2.3312, 1.9361, 2.0191, 2.0422, 2.0326, 2.1067, 2.0209, 2.0193,
        2.0261, 2.0539, 2.0261, 2.0490, 2.0680, 2.0107, 2.0551, 2.0824, 2.0629,
        2.0893, 2.0417, 1.9916, 2.1059, 1.9709, 2.0613, 2.0642, 1.9766, 2.2415,
        2.0278, 2.0139, 2.0696, 2.0614, 2.0622, 2.0453, 2.0202, 2.4513, 2.3828,
        2.4543, 2.4122, 2.4901, 2.4277, 2.4293, 2.4964, 2.4721, 2.4276, 2.3695,
        2.4860, 2.4499, 2.5484, 2.3827, 2.4137, 2.5066, 2.4267, 2.4540, 2.5066,
        2.4732, 2.4824, 2.3642, 2.3329, 2.6345, 2.4322, 2.4664, 2.4670, 2.4122,
        2.4590, 2.3712, 2.3932, 3.2010, 3.1347, 3.2443, 3.0915, 3.2317, 3.1225,
        3.2639, 3.1931, 3.1765, 3.2104, 3.1749, 3.2446, 3.1726, 3.3315, 3.2638,
        3.1336, 3.2543, 3.2592, 3.1204, 3.2220, 3.1167, 3.1631, 3.1058, 3.0825,
        3.3982, 3.1785, 3.4372, 3.2183, 3.2173, 3.1414, 2.9600, 3.1654],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([ 3.4413,  3.6591,  3.1550,  3.5692,  3.6912,  3.4242,  3.6069,  3.9316,
         3.6094,  3.4170,  3.3407,  3.4727,  3.5157,  3.9543,  3.4665,  3.5012,
         4.8296,  3.7735,  3.7319,  3.6034,  3.5355,  3.7784,  3.5077,  3.6239,
         3.6515,  3.2928,  3.7295,  3.4874,  3.5063,  3.3818,  3.5016,  3.2561,
         4.1755,  3.8809,  4.0147,  4.0652,  4.0547,  3.8852,  4.0950,  4.1368,
         4.1231,  3.9393,  4.1408,  3.8886,  3.8035,  4.1407,  3.6988,  3.9102,
         4.7416,  4.1463,  3.9795,  3.6553,  4.0799,  4.0107,  4.1065,  3.9475,
         4.0157,  3.8393,  3.7751,  4.3475,  4.0033,  3.9960,  4.1841,  3.6335,
         5.7500,  5.0878,  5.2461,  4.9366,  5.1634,  5.5036,  6.2101,  5.9462,
         5.2610,  4.9835,  5.6115,  5.3724,  5.2371,  5.2699,  5.6831,  5.3572,
         5.2746,  5.5559,  5.1584,  5.0039,  5.2236,  5.1581,  5.4755,  5.5974,
         5.9155,  5.6650,  5.0617,  4.9412,  5.1880,  5.5139,  5.0777,  5.4577,
         7.4740,  7.3773,  8.0445,  7.6969,  7.5499,  7.4951,  7.2740,  8.5175,
         7.8637,  7.1153,  7.8752,  7.5208,  7.9807,  8.0086,  7.4364,  7.1329,
         7.6212,  8.0216,  7.5661,  7.1947,  7.4386,  7.3780,  7.3503,  7.6870,
         8.0653,  7.3029,  8.1445,  7.7251,  7.3902,  7.4234,  6.7230,  7.5269,
         5.1171,  5.3421,  4.6343,  4.8770,  5.2976,  4.7418,  4.9150,  4.9261,
         4.9551,  5.2423,  4.6947,  4.7060,  4.8629,  4.2242,  4.8129,  4.6407,
         5.8187,  5.0705,  5.0946,  4.7824,  4.9392,  5.9753,  5.2482,  4.9345,
         4.7308,  4.7383,  4.5499,  4.8213,  5.1329,  4.8585,  4.6482,  5.8295,
         4.8942,  4.6159,  5.0234,  5.0875,  4.7134,  4.5025,  4.3002,  4.6977,
         4.8206,  5.1473,  4.7992,  5.0911,  4.4829,  4.4317,  4.8660,  5.1478,
         5.0278,  5.0387,  5.0870,  4.4141,  4.6632,  5.2173,  4.8416,  4.7586,
         4.6033,  4.7020,  4.8287,  4.8072,  4.7915,  4.7302,  4.7692,  5.8374,
         6.3047,  5.6120,  5.9867,  5.6838,  6.0427,  5.8100,  5.3124,  6.0239,
         5.8760,  5.9350,  6.2069,  5.9625,  5.5820,  5.9954,  5.6058,  5.6778,
         5.9873,  6.1898,  5.5371,  5.5429,  6.0192,  6.0163,  6.0825,  5.1985,
         5.6979,  6.1279,  5.5297,  5.6774,  6.0566,  5.8820,  5.9171,  6.1779,
         8.1011,  7.6523,  7.9010,  7.6978,  8.0778,  7.3218,  7.7712,  7.9209,
         7.7348,  7.6633,  7.8513,  7.7359,  7.7029,  8.0897,  7.3723,  7.3979,
         8.7731,  7.4656,  7.4593,  7.6666,  7.6624,  8.3272,  8.1012,  7.8379,
         7.3311,  7.5527,  8.8703,  7.2216,  7.9920,  7.6024,  7.2110,  6.8709,
         6.3958,  6.5568,  5.9858,  6.8050,  6.7904,  5.4244,  6.0128,  6.2837,
         5.8102,  6.3116,  5.9535,  6.0130,  5.5238,  5.9008,  6.6588,  6.3728,
         6.5041,  6.5428,  6.3533,  7.5024,  6.0998,  8.3117,  6.0614,  6.9192,
         6.8692,  6.5490,  5.6767,  6.2768,  6.7715,  7.0676,  5.8612,  5.1828,
         5.0979,  4.5031,  4.9757,  4.6792,  4.7523,  4.1542,  4.3635,  4.6929,
         4.8015,  5.1043,  4.2051,  5.4032,  4.3937,  5.2556,  4.7396,  4.8906,
         5.0395,  4.7465,  4.5253,  4.7112,  4.6431,  5.5368,  4.5064,  4.4716,
         5.0790,  5.1068,  4.3285,  4.7966,  4.5108,  4.7619,  5.0214,  4.6290,
         7.2644,  6.6123,  7.1212,  6.6035,  7.6016,  5.7349,  5.7400,  5.7758,
         7.2996,  6.0851,  6.1691,  6.8497,  6.4676,  7.3114,  6.5175,  6.9353,
         6.9558,  5.8173,  6.3522,  6.4430,  6.4444,  6.3021,  6.3763,  6.5763,
         6.4279,  6.5999,  5.8016,  6.3113,  6.2480,  7.2149,  6.8511,  7.5054,
        12.9967, 10.8409, 12.3679, 11.3964, 12.3326, 10.4547, 11.6460, 10.7809,
        10.6703, 11.7405, 11.5427, 12.5633, 10.9447, 11.2393, 11.9936, 11.9948,
        12.3792, 11.1321, 10.8734, 12.2586, 10.9596, 12.3395, 11.8008, 11.0767,
        10.1275, 10.6564, 14.0866, 11.2013, 11.5474, 12.2137, 11.1890, 10.6174,
         5.0202,  5.6850,  5.3072,  5.5068,  5.7404,  5.3900,  5.2844,  5.5232,
         5.3853,  5.7355,  5.4325,  5.3449,  5.4476,  5.8138,  5.6879,  5.6476,
         5.8996,  5.2870,  5.0229,  5.9146,  5.4811,  6.0888,  5.3992,  5.4060,
         6.5141,  5.5196,  5.1596,  5.7859,  5.8189,  5.6355,  5.8369,  5.4343,
         3.7486,  4.0769,  4.1707,  4.1316,  4.4380,  4.0840,  4.0778,  4.1050,
         4.2185,  4.1049,  4.1985,  4.2766,  4.0428,  4.2233,  4.3362,  4.2554,
         4.3652,  4.1686,  3.9667,  4.4348,  3.8846,  4.2490,  4.2610,  3.9069,
         5.0244,  4.1121,  4.0556,  4.2832,  4.2494,  4.2525,  4.1831,  4.0813,
         6.0087,  5.6776,  6.0237,  5.8185,  6.2006,  5.8939,  5.9014,  6.2322,
         6.1111,  5.8935,  5.6144,  6.1803,  6.0022,  6.4945,  5.6771,  5.8260,
         6.2830,  5.8890,  6.0219,  6.2829,  6.1167,  6.1624,  5.5896,  5.4424,
         6.9406,  5.9158,  6.0829,  6.0860,  5.8185,  6.0465,  5.6224,  5.7276,
        10.2466,  9.8261, 10.5256,  9.5575, 10.4439,  9.7501, 10.6528, 10.1959,
        10.0899, 10.3064, 10.0800, 10.5274, 10.0655, 11.0992, 10.6522,  9.8192,
        10.5908, 10.6223,  9.7371, 10.3814,  9.7136, 10.0051,  9.6458,  9.5017,
        11.5477, 10.1026, 11.8144, 10.3572, 10.3511,  9.8682,  8.7618, 10.0200],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 3173.890625
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([3.1125, 3.2151, 3.5006, 3.1705, 3.1407, 3.3550, 3.0646, 3.2451, 3.2064,
        3.2076, 3.2876, 3.1208, 3.3962, 3.0733, 3.3245, 3.1891, 2.8375, 3.1968,
        3.2276, 3.1930, 3.3050, 3.0763, 3.1009, 3.2580, 3.3626, 3.3261, 3.0823,
        3.3145, 3.1868, 3.1728, 3.1433, 3.4478, 2.7035, 2.8081, 2.7650, 2.8486,
        2.7358, 2.7511, 2.7917, 2.8000, 2.5888, 2.7944, 2.7863, 2.8150, 2.8675,
        2.6530, 2.8834, 2.8043, 2.5768, 2.7966, 2.6663, 2.9819, 2.8382, 2.7212,
        2.7479, 2.7712, 2.8334, 2.8908, 2.9096, 2.7014, 2.6916, 2.8641, 2.6930,
        2.8713, 2.1360, 2.1567, 2.1712, 2.1985, 2.1215, 2.2308, 2.0714, 2.2969,
        2.1155, 2.2222, 2.1707, 2.1827, 2.2611, 2.2641, 2.1322, 2.1163, 2.1233,
        2.0747, 2.2030, 2.2573, 2.1098, 2.2014, 2.0551, 2.2122, 2.2556, 2.1161,
        2.1621, 2.2549, 2.1911, 2.1174, 2.2191, 2.2664, 1.4895, 1.6149, 1.5702,
        1.5632, 1.5957, 1.5239, 1.5063, 1.5810, 1.5451, 1.5249, 1.5931, 1.5227,
        1.6455, 1.7244, 1.6793, 1.5516, 1.4643, 1.5691, 1.5724, 1.4860, 1.6017,
        1.4632, 1.5407, 1.5396, 1.6638, 1.5046, 1.4763, 1.6868, 1.5625, 1.5166,
        1.7292, 1.6209, 2.7848, 2.8454, 2.9385, 2.7366, 2.7716, 2.9828, 2.8989,
        2.8930, 2.7899, 2.8847, 2.8761, 2.9021, 2.9099, 3.0522, 2.9099, 2.8836,
        2.6751, 2.7251, 2.8155, 2.9797, 2.8440, 2.7672, 2.7584, 2.7875, 2.9254,
        2.8340, 2.9170, 2.8680, 2.8498, 2.8888, 2.6991, 2.6935, 2.4847, 2.4514,
        2.3694, 2.4272, 2.3788, 2.5051, 2.5529, 2.5434, 2.3572, 2.4423, 2.5206,
        2.3993, 2.5190, 2.5064, 2.4704, 2.3711, 2.5050, 2.4157, 2.3762, 2.4731,
        2.3961, 2.4867, 2.3450, 2.4459, 2.5113, 2.3715, 2.4737, 2.5156, 2.3955,
        2.4548, 2.3769, 2.3810, 1.7803, 1.8352, 1.7429, 1.8566, 1.8580, 1.8714,
        1.9359, 1.7890, 1.8145, 1.8214, 1.8822, 1.8047, 1.8624, 1.8402, 1.9005,
        1.8962, 1.8528, 1.7858, 1.7591, 1.8756, 1.8918, 1.7180, 1.8758, 1.9135,
        1.8178, 1.8025, 1.9293, 1.8626, 1.8160, 1.7472, 1.9157, 1.8062, 1.4356,
        1.4623, 1.5189, 1.3345, 1.4757, 1.5179, 1.3784, 1.5800, 1.5561, 1.4413,
        1.4853, 1.4688, 1.5139, 1.4883, 1.4755, 1.5173, 1.4668, 1.4221, 1.4361,
        1.4635, 1.4149, 1.4157, 1.4640, 1.4919, 1.5099, 1.4952, 1.4181, 1.5094,
        1.4715, 1.4275, 1.4567, 1.5463, 2.5899, 2.6775, 2.5903, 2.5470, 2.5943,
        2.6687, 2.6036, 2.5612, 2.6724, 2.5447, 2.6299, 2.5611, 2.6686, 2.6546,
        2.5500, 2.6142, 2.5812, 2.5063, 2.6294, 2.4917, 2.5920, 2.4777, 2.5124,
        2.5360, 2.5820, 2.5618, 2.7093, 2.6446, 2.5502, 2.5506, 2.5393, 2.7169,
        2.4160, 2.4368, 2.4040, 2.4027, 2.4511, 2.4479, 2.4596, 2.4156, 2.3596,
        2.2881, 2.4272, 2.3774, 2.4327, 2.4268, 2.5235, 2.3399, 2.4394, 2.3416,
        2.5212, 2.3750, 2.3387, 2.3181, 2.4482, 2.4901, 2.4518, 2.4078, 2.5027,
        2.4235, 2.3666, 2.4271, 2.3029, 2.3461, 1.7584, 1.8788, 1.8738, 1.7007,
        1.7503, 1.8417, 1.8260, 1.8453, 1.7492, 1.8939, 1.7852, 1.7956, 1.8274,
        1.7727, 1.8047, 1.8062, 1.7977, 1.8802, 1.7262, 1.8455, 1.7070, 1.8047,
        1.7744, 1.7232, 1.9179, 1.7946, 1.8413, 1.8531, 1.7778, 1.7498, 1.8053,
        1.6831, 1.3540, 1.4200, 1.4389, 1.4133, 1.3976, 1.4167, 1.3713, 1.4192,
        1.4280, 1.4006, 1.4352, 1.3566, 1.4000, 1.4604, 1.4365, 1.3482, 1.4754,
        1.4151, 1.4684, 1.3757, 1.3507, 1.4708, 1.4766, 1.3856, 1.4558, 1.3975,
        1.4190, 1.4190, 1.4084, 1.4236, 1.3360, 1.5631, 2.5406, 2.4027, 2.6699,
        2.6300, 2.5001, 2.6986, 2.6288, 2.5383, 2.4885, 2.5164, 2.6170, 2.5905,
        2.7218, 2.4163, 2.5174, 2.4598, 2.5698, 2.5183, 2.5230, 2.4013, 2.4618,
        2.5437, 2.4741, 2.3793, 2.3218, 2.5679, 2.7801, 2.5009, 2.5176, 2.5502,
        2.4407, 2.7930, 2.3280, 2.2960, 2.2803, 2.2816, 2.1992, 2.4162, 2.3130,
        2.3145, 2.2547, 2.2997, 2.3718, 2.2820, 2.4138, 2.2888, 2.2292, 2.2810,
        2.3705, 2.3753, 2.2717, 2.2399, 2.4332, 2.3694, 2.3388, 2.2186, 2.1653,
        2.2932, 2.4740, 2.2552, 2.2444, 2.3139, 2.2095, 2.4647, 1.6739, 1.7633,
        1.7967, 1.6606, 1.7706, 1.8792, 1.7577, 1.7617, 1.7558, 1.7750, 1.9249,
        1.7152, 1.9141, 1.7937, 1.8175, 1.8245, 1.9119, 1.8026, 1.7165, 1.7598,
        1.7426, 1.8193, 1.8489, 1.7576, 1.6859, 1.8142, 1.9307, 1.8141, 1.7516,
        1.7824, 1.7874, 1.9062, 1.2829, 1.3995, 1.2735, 1.3947, 1.2951, 1.4753,
        1.3401, 1.3175, 1.3979, 1.3049, 1.3737, 1.3510, 1.4677, 1.3956, 1.4337,
        1.2723, 1.5363, 1.2931, 1.3676, 1.3671, 1.3746, 1.3423, 1.3114, 1.3294,
        1.2245, 1.4295, 1.3285, 1.4176, 1.3926, 1.3617, 1.3081, 1.4288],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([ 9.6878, 10.3371, 12.2543, 10.0521,  9.8641, 11.2558,  9.3915, 10.5305,
        10.2807, 10.2886, 10.8086,  9.7393, 11.5340,  9.4455, 11.0520, 10.1705,
         8.0516, 10.2198, 10.4176, 10.1952, 10.9230,  9.4638,  9.6158, 10.6148,
        11.3069, 11.0628,  9.5008, 10.9858, 10.1558, 10.0668,  9.8806, 11.8876,
         7.3088,  7.8853,  7.6454,  8.1147,  7.4846,  7.5684,  7.7938,  7.8403,
         6.7021,  7.8084,  7.7633,  7.9240,  8.2226,  7.0386,  8.3138,  7.8641,
         6.6399,  7.8210,  7.1091,  8.8918,  8.0551,  7.4051,  7.5508,  7.6796,
         8.0284,  8.3568,  8.4658,  7.2978,  7.2445,  8.2033,  7.2523,  8.2442,
         4.5624,  4.6512,  4.7141,  4.8335,  4.5009,  4.9765,  4.2907,  5.2757,
         4.4755,  4.9381,  4.7121,  4.7642,  5.1128,  5.1260,  4.5464,  4.4787,
         4.5085,  4.3046,  4.8530,  5.0952,  4.4513,  4.8461,  4.2234,  4.8937,
         5.0876,  4.4779,  4.6745,  5.0848,  4.8009,  4.4834,  4.9244,  5.1365,
         2.2187,  2.6080,  2.4656,  2.4435,  2.5462,  2.3222,  2.2689,  2.4996,
         2.3873,  2.3254,  2.5379,  2.3187,  2.7077,  2.9735,  2.8200,  2.4076,
         2.1440,  2.4620,  2.4723,  2.2081,  2.5655,  2.1409,  2.3737,  2.3705,
         2.7684,  2.2638,  2.1796,  2.8454,  2.4413,  2.3001,  2.9902,  2.6274,
         7.7550,  8.0965,  8.6350,  7.4889,  7.6817,  8.8968,  8.4039,  8.3694,
         7.7837,  8.3213,  8.2720,  8.4223,  8.4676,  9.3158,  8.4675,  8.3149,
         7.1563,  7.4264,  7.9272,  8.8786,  8.0884,  7.6575,  7.6087,  7.7703,
         8.5578,  8.0315,  8.5089,  8.2254,  8.1212,  8.3452,  7.2849,  7.2552,
         6.1737,  6.0094,  5.6142,  5.8913,  5.6588,  6.2756,  6.5172,  6.4691,
         5.5563,  5.9649,  6.3533,  5.7566,  6.3456,  6.2821,  6.1027,  5.6219,
         6.2748,  5.8355,  5.6462,  6.1160,  5.7413,  6.1839,  5.4990,  5.9825,
         6.3068,  5.6240,  6.1193,  6.3284,  5.7383,  6.0262,  5.6497,  5.6690,
         3.1696,  3.3679,  3.0376,  3.4471,  3.4523,  3.5021,  3.7478,  3.2004,
         3.2923,  3.3175,  3.5426,  3.2568,  3.4685,  3.3862,  3.6121,  3.5954,
         3.4329,  3.1891,  3.0945,  3.5181,  3.5789,  2.9516,  3.5185,  3.6615,
         3.3045,  3.2489,  3.7220,  3.4692,  3.2977,  3.0528,  3.6699,  3.2622,
         2.0609,  2.1382,  2.3070,  1.7810,  2.1777,  2.3039,  1.8999,  2.4965,
         2.4214,  2.0774,  2.2062,  2.1574,  2.2919,  2.2149,  2.1772,  2.3023,
         2.1515,  2.0223,  2.0623,  2.1418,  2.0020,  2.0043,  2.1433,  2.2259,
         2.2798,  2.2356,  2.0109,  2.2782,  2.1652,  2.0376,  2.1219,  2.3910,
         6.7076,  7.1688,  6.7096,  6.4871,  6.7304,  7.1219,  6.7787,  6.5598,
         7.1416,  6.4756,  6.9161,  6.5590,  7.1215,  7.0468,  6.5027,  6.8339,
         6.6626,  6.2818,  6.9135,  6.2087,  6.7182,  6.1390,  6.3120,  6.4314,
         6.6669,  6.5628,  7.3403,  6.9941,  6.5038,  6.5057,  6.4480,  7.3817,
         5.8372,  5.9381,  5.7792,  5.7731,  6.0079,  5.9921,  6.0496,  5.8350,
         5.5679,  5.2353,  5.8911,  5.6520,  5.9181,  5.8891,  6.3680,  5.4749,
         5.9506,  5.4831,  6.3562,  5.6408,  5.4696,  5.3736,  5.9938,  6.2005,
         6.0112,  5.7976,  6.2637,  5.8734,  5.6006,  5.8910,  5.3035,  5.5040,
         3.0919,  3.5300,  3.5113,  2.8925,  3.0635,  3.3920,  3.3342,  3.4051,
         3.0596,  3.5868,  3.1869,  3.2243,  3.3395,  3.1424,  3.2570,  3.2625,
         3.2316,  3.5352,  2.9797,  3.4060,  2.9138,  3.2568,  3.1486,  2.9695,
         3.6783,  3.2205,  3.3902,  3.4339,  3.1606,  3.0620,  3.2591,  2.8327,
         1.8332,  2.0164,  2.0705,  1.9975,  1.9531,  2.0069,  1.8805,  2.0142,
         2.0390,  1.9617,  2.0597,  1.8403,  1.9601,  2.1328,  2.0636,  1.8178,
         2.1767,  2.0025,  2.1563,  1.8925,  1.8243,  2.1633,  2.1803,  1.9200,
         2.1193,  1.9531,  2.0136,  2.0135,  1.9837,  2.0266,  1.7849,  2.4434,
         6.4547,  5.7729,  7.1285,  6.9168,  6.2505,  7.2823,  6.9105,  6.4431,
         6.1928,  6.3324,  6.8484,  6.7107,  7.4079,  5.8387,  6.3371,  6.0505,
         6.6037,  6.3417,  6.3655,  5.7662,  6.0605,  6.4706,  6.1213,  5.6612,
         5.3908,  6.5942,  7.7287,  6.2544,  6.3384,  6.5034,  5.9572,  7.8010,
         5.4195,  5.2718,  5.1996,  5.2059,  4.8366,  5.8378,  5.3502,  5.3567,
         5.0839,  5.2884,  5.6256,  5.2074,  5.8263,  5.2385,  4.9692,  5.2029,
         5.6193,  5.6422,  5.1605,  5.0172,  5.9203,  5.6139,  5.4702,  4.9222,
         4.6884,  5.2587,  6.1206,  5.0858,  5.0372,  5.3540,  4.8819,  6.0750,
         2.8018,  3.1091,  3.2280,  2.7576,  3.1350,  3.5314,  3.0893,  3.1036,
         3.0828,  3.1505,  3.7054,  2.9420,  3.6638,  3.2175,  3.3032,  3.3288,
         3.6553,  3.2493,  2.9463,  3.0968,  3.0368,  3.3100,  3.4184,  3.0891,
         2.8424,  3.2913,  3.7276,  3.2911,  3.0680,  3.1771,  3.1950,  3.6338,
         1.6459,  1.9585,  1.6218,  1.9453,  1.6772,  2.1766,  1.7957,  1.7359,
         1.9542,  1.7028,  1.8872,  1.8252,  2.1541,  1.9477,  2.0556,  1.6188,
         2.3602,  1.6720,  1.8703,  1.8688,  1.8895,  1.8018,  1.7198,  1.7674,
         1.4993,  2.0435,  1.7650,  2.0096,  1.9394,  1.8543,  1.7112,  2.0416],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 2547.130126953125
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([2.8085, 2.6495, 2.9150, 2.8342, 2.7600, 2.7728, 2.6855, 2.5307, 2.5879,
        2.8475, 2.8360, 2.6796, 2.6044, 2.5362, 2.7779, 2.7983, 2.3958, 2.7428,
        2.9079, 2.5806, 2.6547, 2.8297, 2.6221, 2.5539, 2.6549, 2.9042, 2.9187,
        2.7648, 2.5436, 2.7846, 2.5902, 2.6959, 2.6488, 2.6344, 2.7117, 2.7038,
        2.7133, 2.5324, 2.5856, 2.5182, 2.4054, 2.7781, 2.7357, 2.7745, 2.6847,
        2.5616, 2.6435, 2.6182, 2.4303, 2.5948, 2.6410, 2.8202, 2.6351, 2.5924,
        2.6652, 2.5652, 2.5710, 2.7670, 2.8098, 2.6921, 2.3579, 2.8726, 2.4927,
        2.4678, 3.0415, 2.9924, 2.9157, 2.8984, 3.0021, 2.8698, 2.9080, 2.8992,
        2.9050, 3.0960, 2.9331, 2.9735, 2.9661, 3.0567, 3.0009, 3.0325, 3.0096,
        2.8526, 2.9549, 3.1030, 2.7182, 3.0346, 2.8411, 2.8582, 2.9607, 3.0614,
        2.9588, 3.0071, 2.7662, 2.9568, 2.7428, 3.0059, 2.4576, 2.5680, 2.4808,
        2.4781, 2.5856, 2.4136, 2.5340, 2.3581, 2.3916, 2.6732, 2.4522, 2.5101,
        2.3792, 2.6300, 2.5066, 2.6196, 2.4665, 2.3521, 2.4520, 2.5811, 2.3648,
        2.4747, 2.4828, 2.4552, 2.5037, 2.6112, 2.3383, 2.4766, 2.3934, 2.4768,
        2.6191, 2.5762, 2.6166, 2.4951, 2.6297, 2.4207, 2.6211, 2.5784, 2.6267,
        2.3974, 2.4441, 2.7030, 2.5624, 2.6848, 2.4077, 2.6202, 2.6475, 2.6078,
        2.3736, 2.4894, 2.5539, 2.6002, 2.5721, 2.5619, 2.4838, 2.5020, 2.6846,
        2.5826, 2.8324, 2.5961, 2.5287, 2.5527, 2.4004, 2.3942, 2.4706, 2.3708,
        2.4195, 2.3938, 2.4338, 2.4164, 2.5253, 2.4601, 2.3194, 2.5686, 2.4380,
        2.5410, 2.4570, 2.4622, 2.4848, 2.4006, 2.5052, 2.3181, 2.4605, 2.3440,
        2.3758, 2.4561, 2.4817, 2.4304, 2.5350, 2.3912, 2.5804, 2.5038, 2.2783,
        2.5110, 2.3161, 2.2775, 2.8216, 2.7173, 2.6716, 2.6591, 2.8243, 2.7210,
        2.8025, 2.6193, 2.7285, 2.7750, 2.7244, 2.7365, 2.7094, 2.7967, 2.8133,
        2.7544, 2.6439, 2.6352, 2.6685, 2.7837, 2.7327, 2.6316, 2.7855, 2.7185,
        2.8748, 2.8110, 2.7332, 2.8286, 2.7161, 2.6579, 2.7018, 2.6054, 2.5156,
        2.5081, 2.5059, 2.3347, 2.4268, 2.4881, 2.5712, 2.4746, 2.5765, 2.6025,
        2.5252, 2.4699, 2.4635, 2.4736, 2.4844, 2.6424, 2.4001, 2.4207, 2.4655,
        2.5482, 2.5302, 2.4710, 2.3048, 2.4285, 2.5921, 2.5337, 2.4047, 2.5920,
        2.4552, 2.5271, 2.4579, 2.5896, 2.5401, 2.4752, 2.4148, 2.4486, 2.3687,
        2.3729, 2.4747, 2.2548, 2.3710, 2.3730, 2.3769, 2.4820, 2.4022, 2.4525,
        2.4041, 2.5041, 2.3478, 2.3027, 2.4026, 2.3152, 2.3169, 2.2576, 2.5125,
        2.3029, 2.3955, 2.3895, 2.6613, 2.3883, 2.3897, 2.3127, 2.4844, 2.5027,
        2.2745, 2.2303, 2.3270, 2.3078, 2.2081, 2.2188, 2.2231, 2.2640, 2.2863,
        2.2089, 2.1448, 2.3232, 2.2755, 2.1837, 2.3099, 2.2676, 2.2654, 2.3774,
        2.2888, 2.1991, 2.2492, 2.1483, 2.2985, 2.2632, 2.3635, 2.2413, 2.5069,
        2.4108, 2.2093, 2.2182, 2.2656, 2.1651, 2.6656, 2.6726, 2.6442, 2.6498,
        2.5672, 2.6811, 2.6989, 2.7772, 2.5883, 2.7262, 2.5685, 2.6690, 2.6568,
        2.5658, 2.5940, 2.6634, 2.5471, 2.5679, 2.5789, 2.6898, 2.5422, 2.5949,
        2.6791, 2.6472, 2.8408, 2.5765, 2.6943, 2.7869, 2.5522, 2.5631, 2.5296,
        2.4710, 2.3709, 2.3852, 2.3410, 2.2124, 2.3550, 2.3893, 2.5411, 2.3372,
        2.3810, 2.4417, 2.2693, 2.3438, 2.3622, 2.3160, 2.3696, 2.3124, 2.1729,
        2.2999, 2.4604, 2.4040, 2.2781, 2.3463, 2.2712, 2.3337, 2.6099, 2.3171,
        2.2615, 2.3871, 2.4378, 2.4067, 2.2914, 2.4085, 2.3568, 2.1967, 2.1766,
        2.2729, 2.2608, 2.1395, 2.2897, 2.1786, 2.2183, 2.1884, 2.1619, 2.2990,
        2.2153, 2.1262, 2.1467, 2.2628, 1.9956, 2.2332, 2.2527, 2.1906, 2.1065,
        2.0836, 2.1538, 2.1915, 2.0711, 2.3092, 2.3974, 2.2431, 2.1071, 2.0752,
        2.0803, 2.2066, 2.1335, 2.0297, 1.9540, 1.9472, 1.9491, 2.0215, 1.8940,
        1.9485, 2.0132, 2.0636, 1.9877, 2.0879, 1.9484, 1.9772, 1.9466, 2.0266,
        1.9307, 2.0665, 2.0283, 1.9528, 2.1044, 1.8461, 1.9922, 1.9683, 1.9933,
        1.9373, 2.1810, 2.0373, 2.0070, 1.9049, 2.0157, 1.9803, 2.4880, 2.4989,
        2.2962, 2.4023, 2.4396, 2.4277, 2.4724, 2.3877, 2.4338, 2.5355, 2.4688,
        2.3730, 2.4422, 2.3316, 2.3872, 2.5238, 2.3269, 2.4149, 2.4092, 2.3868,
        2.5122, 2.3423, 2.3985, 2.4468, 2.4826, 2.4039, 2.3657, 2.4455, 2.4798,
        2.3541, 2.5521, 2.4576, 2.4925, 2.4125, 2.1375, 2.3078, 2.2605, 2.3357,
        2.4352, 2.2876, 2.2440, 2.3935, 2.2092, 2.2222, 2.3013, 1.9982, 2.1226,
        2.4123, 2.0317, 2.2012, 2.3933, 2.3047, 2.3515, 2.3068, 2.3225, 2.4340,
        2.2977, 2.4086, 2.1351, 2.1540, 2.2112, 2.3718, 2.3880, 2.3240],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([7.8877, 7.0198, 8.4971, 8.0329, 7.6177, 7.6887, 7.2117, 6.4046, 6.6970,
        8.1082, 8.0428, 7.1804, 6.7827, 6.4323, 7.7167, 7.8302, 5.7397, 7.5232,
        8.4559, 6.6595, 7.0476, 8.0071, 6.8756, 6.5226, 7.0486, 8.4345, 8.5186,
        7.6442, 6.4698, 7.7542, 6.7094, 7.2676, 7.0163, 6.9402, 7.3532, 7.3105,
        7.3622, 6.4133, 6.6854, 6.3413, 5.7861, 7.7178, 7.4843, 7.6980, 7.2076,
        6.5619, 6.9879, 6.8551, 5.9066, 6.7332, 6.9747, 7.9533, 6.9435, 6.7206,
        7.1032, 6.5802, 6.6100, 7.6562, 7.8950, 7.2475, 5.5599, 8.2516, 6.2137,
        6.0900, 9.2505, 8.9545, 8.5011, 8.4006, 9.0128, 8.2359, 8.4567, 8.4053,
        8.4388, 9.5849, 8.6033, 8.8419, 8.7977, 9.3433, 9.0053, 9.1959, 9.0579,
        8.1371, 8.7315, 9.6284, 7.3889, 9.2090, 8.0719, 8.1692, 8.7658, 9.3723,
        8.7543, 9.0428, 7.6519, 8.7425, 7.5229, 9.0355, 6.0396, 6.5947, 6.1544,
        6.1412, 6.6852, 5.8257, 6.4210, 5.5605, 5.7199, 7.1459, 6.0133, 6.3005,
        5.6604, 6.9168, 6.2829, 6.8625, 6.0834, 5.5325, 6.0122, 6.6622, 5.5922,
        6.1242, 6.1643, 6.0279, 6.2684, 6.8183, 5.4677, 6.1336, 5.7283, 6.1348,
        6.8597, 6.6368, 6.8468, 6.2257, 6.9156, 5.8596, 6.8704, 6.6480, 6.8997,
        5.7476, 5.9738, 7.3064, 6.5659, 7.2081, 5.7970, 6.8652, 7.0092, 6.8007,
        5.6338, 6.1970, 6.5226, 6.7608, 6.6157, 6.5636, 6.1690, 6.2602, 7.2069,
        6.6699, 8.0225, 6.7398, 6.3945, 6.5161, 5.7622, 5.7322, 6.1041, 5.6208,
        5.8538, 5.7304, 5.9232, 5.8389, 6.3772, 6.0523, 5.3796, 6.5979, 5.9440,
        6.4567, 6.0370, 6.0626, 6.1742, 5.7631, 6.2760, 5.3737, 6.0543, 5.4944,
        5.6446, 6.0322, 6.1586, 5.9068, 6.4261, 5.7179, 6.6585, 6.2691, 5.1908,
        6.3049, 5.3642, 5.1868, 7.9616, 7.3837, 7.1373, 7.0710, 7.9769, 7.4037,
        7.8541, 6.8605, 7.4449, 7.7007, 7.4222, 7.4885, 7.3408, 7.8217, 7.9148,
        7.5870, 6.9901, 6.9445, 7.1206, 7.7490, 7.4675, 6.9253, 7.7589, 7.3905,
        8.2647, 7.9019, 7.4704, 8.0011, 7.3774, 7.0644, 7.2998, 6.7882, 6.3282,
        6.2906, 6.2796, 5.4507, 5.8896, 6.1909, 6.6113, 6.1239, 6.6384, 6.7730,
        6.3766, 6.1004, 6.0687, 6.1186, 6.1722, 6.9822, 5.7605, 5.8596, 6.0788,
        6.4934, 6.4021, 6.1057, 5.3122, 5.8975, 6.7191, 6.4194, 5.7824, 6.7183,
        6.0281, 6.3864, 6.0411, 6.7060, 6.4520, 6.1268, 5.8311, 5.9956, 5.6109,
        5.6305, 6.1242, 5.0843, 5.6217, 5.6310, 5.6498, 6.1603, 5.7705, 6.0150,
        5.7796, 6.2706, 5.5123, 5.3025, 5.7727, 5.3603, 5.3679, 5.0968, 6.3127,
        5.3034, 5.7382, 5.7099, 7.0828, 5.7038, 5.7109, 5.3484, 6.1724, 6.2633,
        5.1733, 4.9741, 5.4150, 5.3261, 4.8757, 4.9230, 4.9421, 5.1255, 5.2270,
        4.8792, 4.6003, 5.3971, 5.1777, 4.7687, 5.3358, 5.1420, 5.1322, 5.6522,
        5.2388, 4.8362, 5.0588, 4.6153, 5.2829, 5.1221, 5.5861, 5.0234, 6.2843,
        5.8118, 4.8808, 4.9204, 5.1331, 4.6875, 7.1052, 7.1426, 6.9918, 7.0216,
        6.5907, 7.1880, 7.2843, 7.7130, 6.6994, 7.4321, 6.5973, 7.1234, 7.0584,
        6.5834, 6.7291, 7.0936, 6.4879, 6.5942, 6.6507, 7.2348, 6.4628, 6.7335,
        7.1778, 7.0076, 8.0703, 6.6385, 7.2590, 7.7669, 6.5138, 6.5696, 6.3991,
        6.1060, 5.6212, 5.6894, 5.4804, 4.8947, 5.5460, 5.7086, 6.4570, 5.4626,
        5.6693, 5.9621, 5.1496, 5.4933, 5.5802, 5.3638, 5.6152, 5.3474, 4.7214,
        5.2895, 6.0535, 5.7794, 5.1898, 5.5053, 5.1585, 5.4462, 6.8116, 5.3690,
        5.1146, 5.6981, 5.9430, 5.7924, 5.2507, 5.8007, 5.5546, 4.8253, 4.7376,
        5.1660, 5.1114, 4.5775, 5.2425, 4.7461, 4.9206, 4.7891, 4.6738, 5.2854,
        4.9074, 4.5207, 4.6082, 5.1203, 3.9822, 4.9870, 5.0747, 4.7988, 4.4372,
        4.3414, 4.6388, 4.8026, 4.2893, 5.3326, 5.7473, 5.0313, 4.4399, 4.3064,
        4.3276, 4.8691, 4.5520, 4.1196, 3.8182, 3.7917, 3.7988, 4.0867, 3.5873,
        3.7966, 4.0531, 4.2586, 3.9511, 4.3592, 3.7963, 3.9093, 3.7893, 4.1069,
        3.7278, 4.2704, 4.1139, 3.8135, 4.4285, 3.4082, 3.9687, 3.8742, 3.9733,
        3.7531, 4.7567, 4.1508, 4.0281, 3.6287, 4.0631, 3.9218, 6.1902, 6.2447,
        5.2726, 5.7712, 5.9518, 5.8939, 6.1128, 5.7011, 5.9236, 6.4286, 6.0952,
        5.6313, 5.9642, 5.4362, 5.6986, 6.3696, 5.4144, 5.8319, 5.8043, 5.6970,
        6.3112, 5.4865, 5.7526, 5.9867, 6.1633, 5.7786, 5.5966, 5.9803, 6.1495,
        5.5420, 6.5132, 6.0400, 6.2124, 5.8200, 4.5687, 5.3259, 5.1099, 5.4555,
        5.9301, 5.2332, 5.0356, 5.7288, 4.8807, 4.9380, 5.2962, 3.9930, 4.5054,
        5.8192, 4.1279, 4.8454, 5.7279, 5.3117, 5.5293, 5.3215, 5.3942, 5.9244,
        5.2793, 5.8012, 4.5585, 4.6396, 4.8895, 5.6254, 5.7026, 5.4008],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 3160.7060546875
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
ffn input shape torch.Size([32, 256, 768])
logits: torch.Size([512, 8])
log_z: tensor([2.4628, 2.4696, 2.2470, 2.5815, 2.4933, 2.4357, 2.5702, 2.4828, 2.4487,
        2.5109, 2.5410, 2.4767, 2.4306, 2.4417, 2.3856, 2.5128, 2.8341, 2.5097,
        2.4724, 2.3422, 2.3701, 2.6561, 2.4669, 2.3321, 2.4101, 2.4358, 2.7351,
        2.5162, 2.4653, 2.4791, 2.5336, 2.3483, 2.7785, 2.6795, 2.7831, 2.8141,
        2.8164, 2.6722, 2.7284, 2.7393, 2.6858, 2.7810, 2.8167, 2.7485, 2.7782,
        2.7458, 2.7480, 2.5700, 2.9340, 2.6496, 2.7625, 2.6162, 2.8494, 2.8274,
        2.6301, 2.6585, 2.6528, 2.7710, 3.0043, 2.9231, 2.6667, 2.7830, 2.6340,
        2.6036, 2.8481, 2.8532, 2.7536, 2.7940, 2.7965, 2.7019, 2.7802, 2.8867,
        2.7601, 2.9231, 2.8963, 2.8618, 2.9427, 2.7751, 2.9170, 2.8000, 2.9012,
        2.7835, 2.7362, 2.8236, 2.7377, 2.8668, 2.7981, 2.9213, 2.7999, 2.8892,
        3.1154, 2.9545, 2.7679, 2.8071, 2.8348, 2.8355, 2.7087, 2.6652, 2.8095,
        2.6812, 2.7156, 2.6482, 2.6994, 2.7206, 2.7367, 2.7403, 2.8022, 2.7361,
        2.7681, 2.5933, 2.7472, 2.6433, 2.8699, 2.7403, 2.7036, 2.7907, 2.6482,
        2.8137, 2.6333, 2.7441, 2.6115, 2.7644, 2.8835, 2.7955, 2.7319, 2.7682,
        2.6759, 2.6767, 2.3588, 2.3449, 2.3115, 2.3696, 2.3497, 2.3079, 2.2921,
        2.3363, 2.3491, 2.4078, 2.3799, 2.3256, 2.3885, 2.1854, 2.3067, 2.2906,
        2.6677, 2.3425, 2.2539, 2.2053, 2.2752, 2.4961, 2.3380, 2.2744, 2.3287,
        2.3484, 2.7050, 2.4468, 2.3386, 2.2491, 2.3306, 2.4614, 2.4225, 2.4605,
        2.4529, 2.5219, 2.4702, 2.4698, 2.3060, 2.5146, 2.5068, 2.5211, 2.4390,
        2.6031, 2.5539, 2.3393, 2.5256, 2.4602, 2.9398, 2.5374, 2.4673, 2.3437,
        2.3445, 2.6146, 2.4745, 2.4373, 2.4435, 2.4608, 2.8031, 2.6276, 2.4736,
        2.4737, 2.4941, 2.5739, 2.5751, 2.5894, 2.7042, 2.6145, 2.6185, 2.6453,
        2.6584, 2.6828, 2.7301, 2.6230, 2.6647, 2.5600, 2.8269, 2.5823, 2.6884,
        2.5864, 2.9347, 2.7568, 2.6522, 2.7040, 2.5844, 2.8359, 2.6938, 2.6244,
        2.6308, 2.6305, 3.1316, 2.7947, 2.5688, 2.6662, 2.6565, 2.6348, 2.5593,
        2.6930, 2.6425, 2.6940, 2.7111, 2.6792, 2.5980, 2.7042, 2.5824, 2.5736,
        2.6841, 2.6714, 2.8015, 2.7107, 2.8224, 2.5963, 2.7266, 2.5885, 2.5279,
        2.6999, 2.6011, 2.7501, 2.7182, 2.6402, 2.5503, 2.6326, 2.7846, 2.7301,
        2.6549, 2.6525, 2.6970, 2.6721, 2.5943, 2.5830, 2.5375, 2.6676, 2.6277,
        2.5700, 2.5047, 2.7028, 2.5069, 2.6670, 2.6423, 2.6289, 2.6671, 2.5490,
        2.7013, 2.5881, 2.9838, 2.6580, 2.5328, 2.6969, 2.6266, 2.6837, 2.6312,
        2.6079, 2.7802, 2.6078, 2.9246, 2.6631, 2.6319, 2.5379, 2.6837, 2.5178,
        2.8880, 2.8432, 2.9119, 2.8307, 2.8737, 2.8509, 2.7966, 2.9260, 2.8817,
        3.0652, 2.8836, 2.9719, 2.9941, 2.8863, 2.9462, 2.9460, 3.2820, 2.9451,
        2.8305, 2.9030, 2.7894, 2.9910, 2.8891, 2.8180, 2.8991, 2.9073, 3.1999,
        2.9748, 2.8967, 2.8772, 2.8465, 2.8953, 2.9623, 2.9870, 3.0435, 2.9761,
        3.0222, 2.9987, 2.9393, 2.9663, 3.0078, 3.0477, 3.0480, 3.0405, 3.0987,
        2.9926, 3.0185, 3.0007, 3.2206, 3.0332, 3.0588, 3.0964, 2.9848, 3.1297,
        2.9112, 2.9075, 2.9643, 3.0341, 3.1667, 3.0218, 2.9980, 2.9944, 3.0139,
        3.0025, 2.8907, 2.9132, 2.9540, 2.8577, 2.8982, 2.8977, 2.7924, 2.8430,
        2.8619, 2.9298, 2.9655, 2.9342, 3.0066, 2.9476, 2.9780, 2.8349, 3.3138,
        2.8691, 2.8854, 2.9793, 2.9091, 3.0189, 2.9258, 2.8958, 2.8361, 2.9285,
        3.0746, 2.9658, 2.8749, 2.8901, 2.7734, 2.8723, 2.9390, 2.9206, 2.9195,
        2.8518, 2.9054, 2.9348, 2.9295, 2.9773, 2.9345, 3.1542, 3.0543, 2.9700,
        3.0016, 3.0537, 3.0572, 2.9642, 3.1190, 2.9058, 2.9327, 3.0608, 2.9589,
        2.9844, 2.9857, 2.9282, 2.9548, 2.9291, 3.3152, 3.0778, 2.9757, 2.9001,
        2.8780, 2.8580, 3.1602, 3.2312, 3.2405, 3.3131, 3.1779, 3.1623, 3.1218,
        3.2007, 3.2922, 3.3177, 3.2640, 3.2871, 3.2544, 3.2967, 3.2757, 3.1849,
        3.4930, 3.2122, 3.1433, 3.2974, 3.1991, 3.1679, 3.1374, 3.1474, 3.2647,
        3.1640, 3.5662, 3.3460, 3.2115, 3.1175, 3.1693, 3.0738, 3.3508, 3.3559,
        3.3033, 3.4220, 3.3087, 3.3469, 3.2962, 3.3053, 3.2987, 3.3832, 3.3579,
        3.2463, 3.4504, 3.3603, 3.4213, 3.2744, 3.6317, 3.3036, 3.2050, 3.3994,
        3.2705, 3.3702, 3.2544, 3.3475, 3.3152, 3.4224, 3.5632, 3.3946, 3.2679,
        3.3152, 3.2204, 3.3016, 3.2116, 3.1831, 3.2300, 3.2485, 3.1479, 3.1519,
        3.1739, 3.1477, 3.2020, 3.2372, 3.2697, 3.2289, 3.3057, 3.3187, 3.3010,
        3.0960, 3.5620, 3.2101, 3.2238, 3.2811, 3.1302, 3.2139, 3.1392, 3.1545,
        3.1831, 3.2581, 3.3411, 3.3127, 3.2333, 3.1465, 3.1697, 3.2039],
       device='cuda:0', grad_fn=<LogsumexpBackward0>)
pow_z: tensor([ 6.0654,  6.0988,  5.0490,  6.6641,  6.2168,  5.9328,  6.6058,  6.1644,
         5.9961,  6.3045,  6.4569,  6.1338,  5.9080,  5.9621,  5.6912,  6.3139,
         8.0321,  6.2986,  6.1129,  5.4861,  5.6175,  7.0549,  6.0858,  5.4385,
         5.8087,  5.9333,  7.4810,  6.3314,  6.0775,  6.1457,  6.4189,  5.5146,
         7.7203,  7.1797,  7.7454,  7.9192,  7.9320,  7.1406,  7.4442,  7.5037,
         7.2137,  7.7337,  7.9340,  7.5542,  7.7184,  7.5392,  7.5513,  6.6048,
         8.6085,  7.0202,  7.6314,  6.8444,  8.1189,  7.9942,  6.9175,  7.0679,
         7.0375,  7.6785,  9.0259,  8.5447,  7.1114,  7.7450,  6.9381,  6.7789,
         8.1115,  8.1408,  7.5822,  7.8062,  7.8202,  7.3004,  7.7294,  8.3332,
         7.6180,  8.5444,  8.3886,  8.1898,  8.6595,  7.7014,  8.5091,  7.8401,
         8.4168,  7.7478,  7.4866,  7.9729,  7.4952,  8.2188,  7.8294,  8.5342,
         7.8395,  8.3477,  9.7058,  8.7292,  7.6615,  7.8800,  8.0362,  8.0403,
         7.3373,  7.1032,  7.8934,  7.1889,  7.3745,  7.0132,  7.2868,  7.4014,
         7.4898,  7.5092,  7.8522,  7.4862,  7.6625,  6.7250,  7.5471,  6.9870,
         8.2361,  7.5093,  7.3097,  7.7880,  7.0130,  7.9169,  6.9345,  7.5298,
         6.8201,  7.6419,  8.3146,  7.8148,  7.4633,  7.6629,  7.1602,  7.1646,
         5.5637,  5.4984,  5.3432,  5.6151,  5.5210,  5.3265,  5.2539,  5.4585,
         5.5181,  5.7977,  5.6637,  5.4083,  5.7047,  4.7760,  5.3208,  5.2467,
         7.1168,  5.4871,  5.0799,  4.8632,  5.1763,  6.2305,  5.4662,  5.1728,
         5.4227,  5.5152,  7.3172,  5.9868,  5.4689,  5.0587,  5.4316,  6.0584,
         5.8686,  6.0542,  6.0167,  6.3602,  6.1017,  6.1001,  5.3178,  6.3232,
         6.2843,  6.3560,  5.9486,  6.7759,  6.5225,  5.4725,  6.3784,  6.0526,
         8.6426,  6.4382,  6.0875,  5.4928,  5.4965,  6.8361,  6.1233,  5.9403,
         5.9708,  6.0554,  7.8571,  6.9042,  6.1187,  6.1190,  6.2208,  6.6248,
         6.6310,  6.7052,  7.3126,  6.8355,  6.8564,  6.9974,  7.0668,  7.1972,
         7.4535,  6.8800,  7.1006,  6.5535,  7.9913,  6.6682,  7.2276,  6.6896,
         8.6126,  7.6001,  7.0339,  7.3115,  6.6790,  8.0424,  7.2565,  6.8876,
         6.9210,  6.9196,  9.8072,  7.8101,  6.5986,  7.1086,  7.0572,  6.9423,
         6.5499,  7.2524,  6.9829,  7.2578,  7.3499,  7.1779,  6.7497,  7.3126,
         6.6686,  6.6232,  7.2042,  7.1362,  7.8485,  7.3481,  7.9661,  6.7410,
         7.4346,  6.7001,  6.3905,  7.2896,  6.7657,  7.5630,  7.3885,  6.9704,
         6.5038,  6.9307,  7.7539,  7.4535,  7.0483,  7.0355,  7.2740,  7.1402,
         6.7303,  6.6717,  6.4388,  7.1161,  6.9046,  6.6050,  6.2734,  7.3052,
         6.2843,  7.1130,  6.9820,  6.9112,  7.1132,  6.4974,  7.2969,  6.6984,
         8.9031,  7.0649,  6.4153,  7.2735,  6.8988,  7.2021,  6.9231,  6.8009,
         7.7293,  6.8009,  8.5531,  7.0923,  6.9269,  6.4408,  7.2022,  6.3393,
         8.3407,  8.0836,  8.4791,  8.0131,  8.2581,  8.1274,  7.8212,  8.5616,
         8.3043,  9.3954,  8.3152,  8.8320,  8.9645,  8.3305,  8.6799,  8.6791,
        10.7714,  8.6739,  8.0120,  8.4276,  7.7810,  8.9461,  8.3470,  7.9409,
         8.4047,  8.4522, 10.2391,  8.8492,  8.3910,  8.2784,  8.1028,  8.3827,
         8.7751,  8.9224,  9.2631,  8.8574,  9.1340,  8.9922,  8.6397,  8.7988,
         9.0471,  9.2882,  9.2904,  9.2446,  9.6022,  8.9554,  9.1111,  9.0042,
        10.3724,  9.2004,  9.3560,  9.5874,  8.9089,  9.7947,  8.4750,  8.4538,
         8.7874,  9.2060, 10.0281,  9.1310,  8.9879,  8.9663,  9.0838,  9.0153,
         8.3560,  8.4867,  8.7259,  8.1667,  8.3997,  8.3969,  7.7974,  8.0827,
         8.1907,  8.5838,  8.7943,  8.6098,  9.0394,  8.6885,  8.8687,  8.0368,
        10.9814,  8.2315,  8.3253,  8.8762,  8.4627,  9.1139,  8.5600,  8.3854,
         8.0435,  8.5758,  9.4533,  8.7959,  8.2652,  8.3524,  7.6918,  8.2500,
         8.6379,  8.5302,  8.5232,  8.1327,  8.4415,  8.6132,  8.5818,  8.8643,
         8.6114,  9.9491,  9.3288,  8.8210,  9.0097,  9.3251,  9.3462,  8.7864,
         9.7280,  8.4439,  8.6010,  9.3685,  8.7552,  8.9068,  8.9145,  8.5744,
         8.7308,  8.5797, 10.9908,  9.4726,  8.8545,  8.4109,  8.2827,  8.1683,
         9.9870, 10.4404, 10.5007, 10.9765, 10.0987, 10.0001,  9.7457, 10.2443,
        10.8383, 11.0070, 10.6540, 10.8050, 10.5910, 10.8683, 10.7299, 10.1434,
        12.2007, 10.3180,  9.8804, 10.8726, 10.2341, 10.0354,  9.8434,  9.9061,
        10.6581, 10.0110, 12.7181, 11.1959, 10.3140,  9.7185, 10.0446,  9.4483,
        11.2280, 11.2618, 10.9119, 11.7102, 10.9476, 11.2016, 10.8648, 10.9249,
        10.8812, 11.4461, 11.2753, 10.5383, 11.9051, 11.2914, 11.7051, 10.7218,
        13.1892, 10.9136, 10.2717, 11.5558, 10.6964, 11.3580, 10.5912, 11.2055,
        10.9906, 11.7127, 12.6967, 11.5234, 10.6789, 10.9909, 10.3712, 10.9005,
        10.3146, 10.1320, 10.4327, 10.5526,  9.9093,  9.9342, 10.0734,  9.9080,
        10.2529, 10.4794, 10.6909, 10.4257, 10.9279, 11.0139, 10.8964,  9.5852,
        12.6880, 10.3051, 10.3926, 10.7658,  9.7979, 10.3290,  9.8546,  9.9512,
        10.1321, 10.6151, 11.1627, 10.9742, 10.4541,  9.9006, 10.0471, 10.2647],
       device='cuda:0', grad_fn=<PowBackward0>)
pow_z.dtype: torch.float32
total_token: 512
torch.sum(mask_z): 4146.05224609375
z_loss: torch.float32
ffn output shape torch.Size([32, 256, 768])
